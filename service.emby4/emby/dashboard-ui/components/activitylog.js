define(["events","listView","globalize","dom","datetime","userSettings","serverNotifications","connectionManager","imageLoader","emby-button"],function(events,listView,globalize,dom,datetime,userSettings,serverNotifications,connectionManager,imageLoader){"use strict";function reloadData(instance,elem){var limit=parseInt(elem.getAttribute("data-activitylimit")||"7"),minDate=new Date,hasUserId="false"!==elem.getAttribute("data-useractivity");hasUserId?minDate.setTime(minDate.getTime()-864e5):minDate.setTime(minDate.getTime()-6048e5),ApiClient.getActivityLog({StartIndex:0,Limit:limit,MinDate:minDate.toISOString(),hasUserId:hasUserId}).then(function(result){var activityContainer=dom.parentWithClass(elem,"activityContainer");activityContainer&&(result.Items.length?activityContainer.classList.remove("hide"):activityContainer.classList.add("hide")),instance.items=result.Items,listView.buildItems(result.Items,{itemsContainer:elem,showDate:!0,moreButton:!1,action:"none",showShortOverview:!0,enableDefaultIcon:!0,overviewButton:!0,roundImage:!0})})}function ActivityLog(options){var element=(this.options=options).element,apiClient=connectionManager.getApiClient(options.serverId);reloadData(this,element);var onUpdate=function(e,apiClient,data){var options=this.options;options&&options.serverId===apiClient.serverId()&&reloadData(this,options.element)}.bind(this);this.updateFn=onUpdate,events.on(serverNotifications,"ActivityLogEntry",onUpdate),apiClient.startMessageListener("ActivityLogEntry","0,1500")}return ActivityLog.prototype.destroy=function(){var options=this.options;if(options){options.element;connectionManager.getApiClient(options.serverId).stopMessageListener("ActivityLogEntry")}var onUpdate=this.updateFn;onUpdate&&events.off(serverNotifications,"ActivityLogEntry",onUpdate),this.items=null,this.options=null},ActivityLog});