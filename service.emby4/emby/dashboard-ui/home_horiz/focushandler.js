define(["imageLoader","itemHelper","backdrop","mediaInfo","focusManager","browser","layoutManager","dom","userSettings","connectionManager"],function(imageLoader,itemHelper,backdrop,mediaInfo,focusManager,browser,layoutManager,dom,userSettings,connectionManager){"use strict";var selectedItemInfoElementHasContent;browser.animate||browser.edge;return function(options){var focusedElement,parent=options.parent;layoutManager.tv&&(dom.addEventListener(parent,"focus",onFocusIn,{capture:!0,passive:!0}),dom.addEventListener(parent,"blur",onFocusOut,{capture:!0,passive:!0}));var selectedItemInfoTimeout,selectedItemInfoElement=options.selectedItemInfoElement,selectedIndexElement=options.selectedIndexElement;function onFocusIn(e){var focused=e.target;if(focusedElement=focused){if(selectedIndexElement){var index=focused.getAttribute("data-index");index&&(selectedIndexElement.innerHTML=1+parseInt(index))}selectedItemInfoElement&&(clearSelectedInfoTimer(),selectedItemInfoTimeout=setTimeout(onSelectedInfoTimeout,500))}}function onFocusOut(e){clearSelectedInfoTimer(),selectedItemInfoElement&&selectedItemInfoElementHasContent&&requestAnimationFrame(clearSelectedItemInfo);focusedElement=null}function clearSelectedInfoTimer(){selectedItemInfoTimeout&&clearTimeout(selectedItemInfoTimeout)}function onSelectedInfoTimeout(){focusedElement&&function(card){if(!1!==options.enableBackdrops||selectedItemInfoElement){var id=card.getAttribute("data-id");if(!id)return;var serverId=card.getAttribute("data-serverid"),apiClient=connectionManager.getApiClient(serverId);apiClient.getItem(apiClient.getCurrentUserId(),id).then(function(item){!1!==options.enableBackdrops&&userSettings.enableBackdrops()&&(browser.slow||browser.edge||backdrop.setBackdrop(item)),function(card,item){if(!selectedItemInfoElement)return;var html="",logoImageUrl=function(item,options){if((options=options||{}).type="Logo",item.ImageTags&&item.ImageTags.Logo)return options.tag=item.ImageTags.Logo,connectionManager.getApiClient(item.ServerId).getScaledImageUrl(item.Id,options);if(item.ParentLogoImageTag)return options.tag=item.ParentLogoImageTag,connectionManager.getApiClient(item.ServerId).getScaledImageUrl(item.ParentLogoItemId,options);return null}(item,{});logoImageUrl&&(html+='<div class="selectedItemInfoLogo" style="background-image:url(\''+logoImageUrl+"');\"></div>");var mediaInfoHtml="Program"===item.Type?mediaInfo.getSecondaryMediaInfoHtml(item):mediaInfo.getPrimaryMediaInfoHtml(item);html+='<div class="selectedItemInfoDetails">',html+='<div class="selectedItemName">',item.AlbumArtist&&(html+=item.AlbumArtist+" - ");item.IsSeries?html+=item.Name:html+=itemHelper.getDisplayName(item);html+="</div>",mediaInfoHtml&&(html+='<div class="selectedItemMediaInfo">',html+=mediaInfoHtml,html+="</div>");html+="</div>",selectedItemInfoElement.innerHTML=html,selectedItemInfoElementHasContent=!0;var rect=card.getBoundingClientRect(),left=Math.min(rect.left,.8*dom.getWindowSize().innerWidth);selectedItemInfoElement.style.left=Math.max(left,70)+"px",html&&selectedItemInfoElement.animate&&function(elem){elem.animate([{opacity:"0",offset:0},{opacity:"1",offset:1}],{duration:140,iterations:1,easing:"ease-out"})}(selectedItemInfoElement)}(card,item)})}}(focusedElement)}function clearSelectedItemInfo(){selectedItemInfoElement.innerHTML="",selectedItemInfoElementHasContent=!1}this.destroy=function(){dom.removeEventListener(parent,"focus",onFocusIn,{capture:!0,passive:!0}),dom.removeEventListener(parent,"blur",onFocusOut,{capture:!0,passive:!0}),selectedItemInfoElement&&(selectedItemInfoElement.innerHTML="")}}});