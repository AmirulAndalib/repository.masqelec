define(["loading","./focushandler","focusManager","scrollHelper","browser","emby-button","scrollStyles","emby-scroller"],function(loading,focusHandler,focusManager,browser){"use strict";function focusViewSlider(){var selected=this.querySelector(".selected");selected?focusManager.focus(selected):focusManager.autoFocus(this)}function parentWithClass(elem,className){for(;!elem.classList||!elem.classList.contains(className);)if(!(elem=elem.parentNode))return null;return elem}return function(page,pageOptions){var self=this;pageOptions=pageOptions||{},page.querySelector(".contentScrollSlider").classList.add("focuscontainer-x");var focusTimeout,selectedItemInfoElement=page.querySelector(".selectedItemInfo"),selectedIndexElement=page.querySelector(".selectedIndex");self.renderTabs=function(tabs){page.querySelector(".userViewNames").innerHTML=tabs.map(function(i){return'<button is="emby-button" class="flat btnUserViewHeader button-link" data-id="'+i.Id+'" data-type="'+(i.CollectionType||"")+'"><span class="userViewButtonText">'+i.Name+"</span></button>"}).join(""),function(view,instance){var userViewNames=view.querySelector(".userViewNames");userViewNames.focus=focusViewSlider,loading.hide(),setTimeout(function(){var initialTab=userViewNames.querySelector(".btnUserViewHeader");initialTab&&instance.setFocusDelay(view,initialTab)},0)}(page,self),function(view){if(pageOptions.handleFocus){var scrollSlider=view.querySelector(".contentScrollSlider");self.focusHandler=new focusHandler({parent:scrollSlider,selectedItemInfoElement:selectedItemInfoElement,selectedIndexElement:selectedIndexElement,animateFocus:pageOptions.animateFocus,enableBackdrops:!0})}}(page),function(view,instance){var userViewNames=view.querySelector(".userViewNames");userViewNames.addEventListener("click",function(e){var elem=parentWithClass(e.target,"btnUserViewHeader");elem&&instance.setFocusDelay(view,elem)}),userViewNames.addEventListener("focus",function(e){var elem=parentWithClass(e.target,"btnUserViewHeader");elem&&instance.setFocusDelay(view,elem)},!0)}(page,self)};var focusDelay=0;self.setFocusDelay=function(view,elem,immediate){var viewId=elem.getAttribute("data-id"),btn=view.querySelector(".btnUserViewHeader.selected");if(!btn||viewId!==btn.getAttribute("data-id")){elem!==btn&&(btn&&btn.classList.remove("selected"),elem.classList.add("selected")),focusTimeout&&clearTimeout(focusTimeout);var onTimeout=function(){!function(page,id,self){var btn=page.querySelector(".btnUserViewHeader[data-id='"+id+"']");page.querySelector(".itemScrollFrame").scrollToPosition(0,!0);var contentScrollSlider=page.querySelector(".contentScrollSlider");contentScrollSlider.innerHTML="";var promise=self.loadViewContent.call(self,page,id,btn.getAttribute("data-type"));promise&&browser.animate&&promise.then(function(){!function(elem){elem.animate([{opacity:"0",transform:"translate3d(1%, 0, 0)",offset:0},{opacity:"1",transform:"none",offset:1}],{duration:300,iterations:1})}(contentScrollSlider)})}(view,viewId,self)};immediate?onTimeout():focusTimeout=setTimeout(onTimeout,focusDelay),focusDelay=700}},self.destroy=function(){self.focusHandler&&(self.focusHandler.destroy(),self.focusHandler=null)}}});