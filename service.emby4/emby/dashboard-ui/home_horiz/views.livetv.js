define(["focusManager","cardBuilder","browser","dom","emby-itemscontainer"],function(focusManager,cardBuilder,browser,dom){"use strict";function getItemsHtml(items,overlayButton,cardOptions){return cardOptions=cardOptions||{},(cardOptions=Object.assign({items:items,preferThumb:"auto",inheritThumb:!1,shape:"auto",defaultShape:"backdrop",showParentTitle:!0,showTitle:!0,centerText:!0,overlayText:!1,lazy:!0,overlayMoreButton:"more"===overlayButton,overlayPlayButton:"play"===overlayButton,showAirTime:!0,showAirDateTime:!0,lines:3,rows:{portrait:2,square:3,backdrop:3,fourThree:3}},cardOptions)).lines=null,cardOptions.showTitle=!1,cardOptions.showParentTitle=!1,cardOptions.showParentTitleOrTitle=!1,cardOptions.showAirTime=!1,cardBuilder.getCardsHtml(cardOptions)}function gotoTvView(tab,parentId,serverId){Emby.Page.show("/livetv?tab="+tab+"&serverId="+serverId)}return function(element,apiClient,parentId,autoFocus){autoFocus&&focusManager.autoFocus(element),this.apiClient=apiClient;var view=element;this.latestItemsContainer=element.querySelector(".latestSection .itemsContainer"),this.latestItemsContainer.fetchData=function(){var apiClient=this.apiClient;return apiClient.getLiveTvRecordings({Limit:6,UserId:apiClient.getCurrentUserId(),ImageTypeLimit:1,Fields:"PrimaryImageAspectRatio,ProductionYear,CommunityRating"})}.bind(this),this.latestItemsContainer.getItemsHtml=function(items){return cardBuilder.getCardsHtml({items:items,shape:"auto",preferThumb:"auto",showParentTitleOrTitle:!0,rows:{portrait:2,square:3,backdrop:3,fourThree:3},overlayText:!0})}.bind(this),this.latestItemsContainer.parentContainer=dom.parentWithClass(this.latestItemsContainer,"horizontalSection"),this.onNowItemsContainer=view.querySelector(".activePrograms .itemsContainer"),this.onNowItemsContainer.fetchData=function(){var apiClient=this.apiClient;return apiClient.getLiveTvRecommendedPrograms({UserId:apiClient.getCurrentUserId(),IsAiring:!0,Limit:12,ImageTypeLimit:1,EnableImageTypes:"Primary,Thumb,Backdrop",EnableTotalRecordCount:!1,Fields:"ChannelInfo,PrimaryImageAspectRatio,ProductionYear,CommunityRating"})}.bind(this),this.onNowItemsContainer.getItemsHtml=function(items){return getItemsHtml(items,"play")}.bind(this),this.onNowItemsContainer.parentContainer=dom.parentWithClass(this.onNowItemsContainer,"horizontalSection"),this.episodeItemsContainer=view.querySelector(".upcomingEpisodes .itemsContainer"),this.episodeItemsContainer.fetchData=function(){var apiClient=this.apiClient;return apiClient.getLiveTvRecommendedPrograms({UserId:apiClient.getCurrentUserId(),HasAired:!1,IsAiring:!1,Limit:12,IsMovie:!1,IsSports:!1,IsKids:!1,IsNews:!1,IsSeries:!0,EnableTotalRecordCount:!1,Fields:"ChannelInfo,PrimaryImageAspectRatio,ProductionYear,CommunityRating",EnableImageTypes:"Primary,Thumb"})}.bind(this),this.episodeItemsContainer.getItemsHtml=function(items){return getItemsHtml(items)}.bind(this),this.episodeItemsContainer.parentContainer=dom.parentWithClass(this.episodeItemsContainer,"horizontalSection"),this.movieItemsContainer=view.querySelector(".upcomingTvMovies .itemsContainer"),this.movieItemsContainer.fetchData=function(){var apiClient=this.apiClient;return apiClient.getLiveTvRecommendedPrograms({userId:apiClient.getCurrentUserId(),HasAired:!1,IsAiring:!1,Limit:12,IsMovie:!0,EnableTotalRecordCount:!1,Fields:"ChannelInfo,PrimaryImageAspectRatio,ProductionYear,CommunityRating",EnableImageTypes:"Primary,Thumb"})}.bind(this),this.movieItemsContainer.getItemsHtml=function(items){return getItemsHtml(items,null,{shape:"portrait",preferThumb:null,lines:2})}.bind(this),this.movieItemsContainer.parentContainer=dom.parentWithClass(this.movieItemsContainer,"horizontalSection"),this.sportsItemsContainer=view.querySelector(".upcomingSports .itemsContainer"),this.sportsItemsContainer.fetchData=function(){var apiClient=this.apiClient;return apiClient.getLiveTvRecommendedPrograms({userId:apiClient.getCurrentUserId(),HasAired:!1,IsAiring:!1,Limit:12,IsSports:!0,EnableTotalRecordCount:!1,Fields:"ChannelInfo,PrimaryImageAspectRatio,ProductionYear,CommunityRating",EnableImageTypes:"Primary,Thumb"})}.bind(this),this.sportsItemsContainer.getItemsHtml=function(items){return getItemsHtml(items,null,{})}.bind(this),this.sportsItemsContainer.parentContainer=dom.parentWithClass(this.sportsItemsContainer,"horizontalSection"),this.kidsItemsContainer=view.querySelector(".upcomingKids .itemsContainer"),this.kidsItemsContainer.fetchData=function(){var apiClient=this.apiClient;return apiClient.getLiveTvRecommendedPrograms({userId:apiClient.getCurrentUserId(),HasAired:!1,IsAiring:!1,Limit:12,IsKids:!0,EnableTotalRecordCount:!1,Fields:"ChannelInfo,PrimaryImageAspectRatio,ProductionYear,CommunityRating",EnableImageTypes:"Primary,Thumb"})}.bind(this),this.kidsItemsContainer.getItemsHtml=function(items){return getItemsHtml(items,null,{})}.bind(this),this.kidsItemsContainer.parentContainer=dom.parentWithClass(this.kidsItemsContainer,"horizontalSection"),this.newsItemsContainer=view.querySelector(".upcomingNews .itemsContainer"),this.newsItemsContainer.fetchData=function(){var apiClient=this.apiClient;return apiClient.getLiveTvRecommendedPrograms({userId:apiClient.getCurrentUserId(),HasAired:!1,IsAiring:!1,Limit:12,IsNews:!0,EnableTotalRecordCount:!1,Fields:"ChannelInfo,PrimaryImageAspectRatio,ProductionYear,CommunityRating",EnableImageTypes:"Primary,Thumb"})}.bind(this),this.newsItemsContainer.getItemsHtml=function(items){return getItemsHtml(items,null,{})}.bind(this),this.newsItemsContainer.parentContainer=dom.parentWithClass(this.newsItemsContainer,"horizontalSection"),this.loadData=function(refresh){var promises=[],options={refresh:refresh};return promises.push(this.latestItemsContainer.resume(options)),promises.push(this.onNowItemsContainer.resume(options)),promises.push(this.episodeItemsContainer.resume(options)),promises.push(this.movieItemsContainer.resume(options)),promises.push(this.sportsItemsContainer.resume(options)),promises.push(this.kidsItemsContainer.resume(options)),promises.push(this.newsItemsContainer.resume(options)),Promise.all(promises)},element.querySelector(".guideCard").addEventListener("click",function(){gotoTvView("1",0,apiClient.serverId())}),element.querySelector(".recordingsCard").addEventListener("click",function(){gotoTvView("3",0,apiClient.serverId())}),element.querySelector(".channelsLiveTvCard").addEventListener("click",function(){gotoTvView("2",0,apiClient.serverId())}),this.onPause=function(){this.latestItemsContainer.pause(),this.onNowItemsContainer.pause(),this.episodeItemsContainer.pause(),this.movieItemsContainer.pause(),this.sportsItemsContainer.pause(),this.kidsItemsContainer.pause(),this.newsItemsContainer.pause()},this.destroy=function(){this.apiClient=null,this.latestItemsContainer=null,this.onNowItemsContainer=null,this.episodeItemsContainer=null,this.movieItemsContainer=null,this.sportsItemsContainer=null,this.kidsItemsContainer=null,this.newsItemsContainer=null}}});