define(["globalize","browser","dom","appHeader","inputManager","listView","layoutManager","userSettings","focusManager","cardBuilder","loading","connectionManager","scroller","playbackManager","alphaPicker","emby-itemscontainer","emby-scroller"],function(globalize,browser,dom,appHeader,inputManager,listView,layoutManager,userSettings,focusManager,cardBuilder,loading,connectionManager,scroller,playbackManager,alphaPicker){"use strict";function initAlphaNumericShortcuts(instance){require(["alphaNumericShortcuts"],function(AlphaNumericShortcuts){instance.alphaNumericShortcuts=new AlphaNumericShortcuts({itemsContainer:instance.itemsContainer}),instance.alphaNumericShortcuts.onAlphaNumericValueEntered=function(value){trySelectValue(this,this.scroller,this.view,value,layoutManager.tv)}.bind(instance)})}function updateSortText(instance){var btnSortText=instance.btnSortText;if(btnSortText){for(var options=instance.getSortMenuOptions(),values=instance.getSortValues(),sortBy=values.sortBy,i=0,length=options.length;i<length;i++)if(sortBy===options[i].value){btnSortText.innerHTML=globalize.translate("SortByValue",options[i].name);break}var btnSortIcon=instance.btnSortIcon;btnSortIcon&&(btnSortIcon.innerHTML="Descending"===values.sortOrder?"&#xE5DB;":"&#xE5D8;")}}function updateItemsContainerForViewType(instance){"list"===instance.getViewSettings().imageType?(instance.itemsContainer.classList.remove("vertical-wrap"),instance.itemsContainer.classList.add("vertical-list")):(instance.itemsContainer.classList.add("vertical-wrap"),instance.itemsContainer.classList.remove("vertical-list"))}function getParentWithSidePadding(instance){var itemsContainer=instance.itemsContainer;return dom.parentWithClass(itemsContainer,"padded-side-parent")||itemsContainer.parentNode}function showViewSettingsMenu(){var instance=this;require(["viewSettings"],function(ViewSettings){(new ViewSettings).show({settingsKey:instance.getSettingsKey(),settings:instance.getViewSettings(),visibleSettings:instance.getVisibleViewSettings()}).then(function(){updateItemsContainerForViewType(instance),refreshAfterSettingsChange(instance)})})}function showFilterMenu(){var instance=this,params=instance.params,query={};params.genreId&&(query.GenreIds=params.genreId);var item=instance.currentItem;item&&("Studio"===item.Type?query.StudioIds=item.Id:"Tag"===item.Type?query.TagIds=item.Id:"Genre"===item.Type||"GameGenre"===item.Type||"MusicGenre"===item.Type?query.GenreIds=item.Id:"Person"===item.Type&&(query.PersonIds=item.Id)),params.artistId&&(query.ArtistIds=params.artistId),params.albumArtistId&&(query.AlbumArtistIds=params.albumArtistId),require(["filterMenu"],function(FilterMenu){(new FilterMenu).show(Object.assign(query,{settingsKey:instance.getSettingsKey(),settings:instance.getFilters(),visibleSettings:instance.getVisibleFilters(),onChange:instance.itemsContainer.refreshItems.bind(instance.itemsContainer),parentId:instance.params.parentId,itemTypes:instance.getItemTypes(),serverId:instance.params.serverId,filterMenuOptions:instance.getFilterMenuOptions()})).then(function(){refreshAfterSettingsChange(instance)})})}function compareByName(a,b){return a.name<b.name?-1:a.name>b.name?1:0}function getDetaultSortOrder(sortBy){return!sortBy||0!==(sortBy=sortBy.toLowerCase()).indexOf("sortname")&&0!==sortBy.indexOf("runtime")&&0!==sortBy.indexOf("album")&&0!==sortBy.indexOf("isfolder")&&0!==sortBy.indexOf("channelnumber")?"Descending":"Ascending"}function showSortMenu(e){var instance=this;require(["actionsheet"],function(actionsheet){var options=instance.getSortMenuOptions();!function(instance,options){for(var currentValues=instance.getSortValues(),i=0,length=options.length;i<length;i++){var opt=options[i];if(opt.selected=opt.value===currentValues.sortBy,opt.selected){var icon="Descending"===currentValues.sortOrder?"&#xE5DB;":"&#xE5D8;";opt.asideIcon=icon;break}}}(instance,options),options.sort(compareByName),actionsheet.show({items:options,positionTo:e.target,title:globalize.translate("LabelSortBy")}).then(function(value){var currentValues=instance.getSortValues(),sortOrder=currentValues.sortOrder;sortOrder=currentValues.sortBy===value?"Ascending"===sortOrder?"Descending":"Ascending":getDetaultSortOrder(value);var settingsKey=instance.getSettingsKey();userSettings.setFilter(settingsKey+"-sortby",value),userSettings.setFilter(settingsKey+"-sortorder",sortOrder),updateSortText(instance),refreshAfterSettingsChange(instance)})})}function refreshAfterSettingsChange(instance){instance.itemsContainer.refreshItems()}function hideOrShowAll(elems,hide){for(var i=0,length=elems.length;i<length;i++)hide?elems[i].classList.add("hide"):elems[i].classList.remove("hide")}function bindAll(elems,eventName,fn){for(var i=0,length=elems.length;i<length;i++)elems[i].addEventListener(eventName,fn)}function trySelectValue(instance,scroller,view,value,focus){value&&"#"!==value?instance.getItems({Limit:0}).then(function(totalResult){instance.getItems({Limit:0,NameStartsWithOrGreater:value}).then(function(result){instance.itemsContainer.scrollToIndex(Math.max(totalResult.TotalRecordCount-result.TotalRecordCount,0),focus)})}):instance.itemsContainer.scrollToIndex(0,focus)}function ItemsView(view,params){var i,length,self=this;self.params=params,self.view=view,null==this.supportsViewSettings&&(this.supportsViewSettings="downloads"!==params.parentId),this.itemsContainer=view.querySelector(".itemsContainer"),params.parentId?this.itemsContainer.setAttribute("data-parentid",params.parentId):"nextup"===params.type?this.itemsContainer.setAttribute("data-monitor","videoplayback"):"favoritemovies"===params.type?this.itemsContainer.setAttribute("data-monitor","markfavorite"):"Program"===params.type&&(this.itemsContainer.setAttribute("data-refreshinterval","300000"),this.enableMultiSelect=!1);var btnViewSettings=view.querySelectorAll(".btnViewSettings"),supportsViewSettings=!1!==this.supportsViewSettings;for(i=0,length=btnViewSettings.length;i<length;i++)btnViewSettings[i].addEventListener("click",showViewSettingsMenu.bind(this)),supportsViewSettings&&btnViewSettings[i].classList.remove("hide");var filterButtons=view.querySelectorAll(".btnFilter");this.filterButtons=filterButtons;var hasVisibleFilters=this.getVisibleFilters().length;for(i=0,length=filterButtons.length;i<length;i++){var btnFilter=filterButtons[i];btnFilter.addEventListener("click",showFilterMenu.bind(this)),hasVisibleFilters?btnFilter.classList.remove("hide"):btnFilter.classList.add("hide")}var sortButtons=view.querySelectorAll(".btnSort");this.sortButtons=sortButtons;var supportsSorting=this.getSortMenuOptions().length;for(i=0,length=sortButtons.length;i<length;i++){var sortButton=sortButtons[i];sortButton.addEventListener("click",showSortMenu.bind(this)),supportsSorting&&sortButton.classList.remove("hide")}function onInputCommand(e){switch(e.detail.command){case"refresh":self.itemsContainer.refreshItems()}}this.btnSortText=view.querySelector(".btnSortText"),this.btnSortIcon=view.querySelector(".btnSortIcon"),supportsSorting||supportsViewSettings||hasVisibleFilters||!1!==this.enableTotalRecordCountDisplay||view.querySelector(".itemsViewSettingsContainer").classList.add("hide"),this.enableAlphaNumericShortcuts=this.enableVirtualData(),this.alphaPickerElement=view.querySelector(".alphaPicker"),self.itemsContainer.afterRefresh=self.afterItemsRefreshed.bind(self),self.itemsContainer.fetchData=self.getItems.bind(self),self.itemsContainer.virtualChunkSize=self.virtualChunkSize(),self.itemsContainer.getListOptions=self.getListOptions.bind(self),view.addEventListener("viewshow",function(e){!1===self.enableMultiSelect&&self.itemsContainer.enableMultiSelect(!1),inputManager.on(window,onInputCommand);var isRestored=e.detail.isRestored;isRestored||(loading.show(),updateSortText(self),updateItemsContainerForViewType(self)),self.setTitle(),function(params){if("Recordings"===params.type)return Promise.resolve(null);if("Program"===params.type)return Promise.resolve(null);if("nextup"===params.type)return Promise.resolve(null);if(!params.serverId)return Promise.resolve(null);var apiClient=connectionManager.getApiClient(params.serverId),itemId=params.genreId||params.gameGenreId||params.musicGenreId||params.studioId||params.tagId||params.personId||params.parentId;return itemId&&"downloads"!==itemId?apiClient.getItem(apiClient.getCurrentUserId(),itemId):Promise.resolve(null)}(params).then(function(item){self.currentItem=item,self.setTitle();var refresh=!isRestored;self.itemsContainer.resume({refresh:refresh}).then(function(){loading.hide(),refresh&&focusManager.autoFocus(self.itemsContainer)}),isRestored||item&&"PhotoAlbum"!==item.Type&&function(){self.scroller=view.querySelector(".scrollFrameY");var alphaPickerElement=self.alphaPickerElement,parentWithSidePadding=getParentWithSidePadding(self);layoutManager.tv?(alphaPickerElement.classList.add("alphaPicker-fixed-left"),alphaPickerElement.classList.add("focuscontainer-left"),alphaPickerElement.classList.remove("alphaPicker-fixed-right"),parentWithSidePadding.classList.add("padded-left-withalphapicker")):(alphaPickerElement.classList.add("alphaPicker-fixed-right"),alphaPickerElement.classList.add("focuscontainer-right"),alphaPickerElement.classList.remove("alphaPicker-fixed-left"),parentWithSidePadding.classList.add("padded-right-withalphapicker"));self.alphaPicker=new alphaPicker({element:alphaPickerElement,itemsContainer:self.itemsContainer,prefixes:[],setValueOnFocus:!0}),self.alphaPicker.on("alphavaluechanged",function(e){var value=e.detail.value;this.scroller,trySelectValue(this,0,this.itemsContainer,value)}.bind(self))}();var itemType=item?item.Type:null;!1!==self.supportsPlayback?("downloads"===params.parentId?hideOrShowAll(view.querySelectorAll(".btnPlay"),!0):"MusicGenre"===itemType||"Program"!==params.type&&"Game"!==params.type&&"Channel"!==itemType&&"GameSystem"!==itemType&&"GameGenre"!==itemType?hideOrShowAll(view.querySelectorAll(".btnPlay"),!1):hideOrShowAll(view.querySelectorAll(".btnPlay"),!0),"downloads"===params.parentId?hideOrShowAll(view.querySelectorAll(".btnShuffle"),!0):"MusicGenre"===itemType||"Program"!==params.type&&"nextup"!==params.type&&"Game"!==params.type&&"Channel"!==itemType&&"GameSystem"!==itemType&&"GameGenre"!==itemType?hideOrShowAll(view.querySelectorAll(".btnShuffle"),!1):hideOrShowAll(view.querySelectorAll(".btnShuffle"),!0),"downloads"===params.parentId?hideOrShowAll(view.querySelectorAll(".btnQueue"),!0):item&&playbackManager.canQueue(item)?hideOrShowAll(view.querySelectorAll(".btnQueue"),!1):hideOrShowAll(view.querySelectorAll(".btnQueue"),!0)):(hideOrShowAll(view.querySelectorAll(".btnPlay"),!0),hideOrShowAll(view.querySelectorAll(".btnShuffle"),!0),hideOrShowAll(view.querySelectorAll(".btnQueue"),!0))}),self.enableAlphaNumericShortcuts&&initAlphaNumericShortcuts(self)}),bindAll(view.querySelectorAll(".btnPlay"),"click",function(){var currentItem=self.currentItem,params=self.params;if(currentItem&&!self.hasFilters)return void playbackManager.play({items:[currentItem],parentId:params.parentId});self.getItems({Limit:300}).then(function(result){playbackManager.play({items:result.Items})})}),bindAll(view.querySelectorAll(".btnQueue"),"click",function(){self.currentItem,self.params;self.getItems({Limit:300}).then(function(result){playbackManager.queue({items:result.Items})})}),bindAll(view.querySelectorAll(".btnShuffle"),"click",function(){var currentItem=self.currentItem,params=self.params;if(currentItem&&!self.hasFilters)return void playbackManager.shuffle(currentItem,null,{parentId:params.parentId});self.getItems({SortBy:"Random",Limit:300}).then(function(result){playbackManager.play({items:result.Items})})}),view.addEventListener("viewhide",function(e){inputManager.off(window,onInputCommand);var itemsContainer=self.itemsContainer;itemsContainer&&itemsContainer.pause();var alphaNumericShortcuts=self.alphaNumericShortcuts;alphaNumericShortcuts&&(alphaNumericShortcuts.destroy(),self.alphaNumericShortcuts=null)}),view.addEventListener("viewdestroy",function(){self.listController&&self.listController.destroy(),self.alphaPicker&&self.alphaPicker.destroy(),self.currentItem=null,self.scroller=null,self.itemsContainer=null,self.filterButtons=null,self.sortButtons=null,self.btnSortText=null,self.btnSortIcon=null,self.alphaPickerElement=null,self.view=view})}function getTopLevelDownloadFolders(apiClient){return apiClient.getLocalFolders()}return ItemsView.prototype.getCardOptions=function(items,settings){var shape,preferThumb,preferDisc,preferLogo,defaultShape,params=this.params,item=this.currentItem,showYear=settings.showYear,showTitle=settings.showTitle,showParentTitle=!1,lines=0;"banner"===settings.imageType?shape="banner":"disc"===settings.imageType?(shape="square",preferDisc=!0):"logo"===settings.imageType?(shape="backdrop",preferLogo=!0):"thumb"===settings.imageType?(shape="backdrop",preferThumb=!0):"nextup"===params.type?(shape="backdrop",preferThumb="thumb"===settings.imageType):"Program"===params.type||"Recordings"===params.type?(preferThumb=shape="auto",defaultShape="true"===params.IsMovie?"portrait":"backdrop"):shape="auto";var posterOptions={shape:shape,centerText:!0,preferThumb:preferThumb,preferDisc:preferDisc,preferLogo:preferLogo,overlayPlayButton:!1,overlayMoreButton:!0,defaultShape:defaultShape,action:"Audio"===params.type?"playallfromhere":null};if(item&&("playlists"!==item.CollectionType&&"boxsets"!==item.CollectionType||(showYear=!1)),"nextup"===params.type)showParentTitle=showTitle;else if("Person"===params.type)showParentTitle=showYear=!1;else if("Audio"===params.type)showParentTitle=showTitle;else if("MusicAlbum"===params.type)showParentTitle=showTitle;else if("Episode"===params.type||"Game"===params.type||params.gameGenreId)showParentTitle=showTitle;else if("MusicArtist"===params.type)showYear=!1;else if("Program"===params.type){showParentTitle=showTitle&&"true"!==params.IsMovie;var showAirTime=showTitle&&"Recordings"!==params.type;showAirTime&&lines++,posterOptions=Object.assign(posterOptions,{inheritThumb:"Recordings"===params.type,context:"livetv",showAirTime:showAirTime,showAirDateTime:showAirTime,overlayPlayButton:!1,overlayMoreButton:!0})}else showParentTitle=showTitle;return showTitle&&(posterOptions.showTitle=!0,lines++),showParentTitle&&(posterOptions.showParentTitle=!0,lines++),showYear&&(posterOptions.showYear=!0,lines++),posterOptions.overlayText=!lines,posterOptions.lines=lines,item&&"folders"===item.CollectionType&&(posterOptions.context="folders"),posterOptions.multiSelect=this.enableMultiSelect,posterOptions},ItemsView.prototype.getListViewOptions=function(items,settings){return{}},ItemsView.prototype.getListOptions=function(items){var settings=this.getViewSettings();return"list"===settings.imageType?{renderer:listView,options:this.getListViewOptions(items,settings),virtualScrollLayout:"vertical"}:{renderer:cardBuilder,options:this.getCardOptions(items,settings),virtualScrollLayout:"vertical-grid"}},ItemsView.prototype.getItems=function(initialQuery){var params=this.params;this.currentItem;if("downloads"===params.parentId)return Promise.all(connectionManager.getApiClients().map(getTopLevelDownloadFolders)).then(function(responses){for(var list=[],i=0,length=responses.length;i<length;i++)list=list.concat(responses[i]);return list});var apiClient=connectionManager.getApiClient(params.serverId);this.queryRecursive=!1;var queryInfo=this.getQueryInfo(!0);if(this.setFilterStatus(queryInfo.hasFilters),initialQuery&&Object.assign(queryInfo.query,initialQuery),this.queryRecursive=queryInfo.query.Recursive,"Recordings"===params.type)return queryInfo.query.UserId=apiClient.getCurrentUserId(),apiClient.getLiveTvRecordings(queryInfo.query);if("nextup"===params.type)return queryInfo.query.UserId=apiClient.getCurrentUserId(),queryInfo.query.EnableTotalRecordCount=!1,apiClient.getNextUpEpisodes(queryInfo.query);if("Program"===params.type&&"true"===params.IsAiring)return queryInfo.query.UserId=apiClient.getCurrentUserId(),apiClient.getLiveTvRecommendedPrograms(queryInfo.query);var method=this.getApiClientQueryMethodName();return"getActivityLog"===method?(queryInfo.query.HasUserId=!1,apiClient.getActivityLog(queryInfo.query)):"getUserActivityLog"===method?(queryInfo.query.HasUserId=!0,apiClient.getActivityLog(queryInfo.query)):apiClient[method](apiClient.getCurrentUserId(),queryInfo.query)},ItemsView.prototype.getApiClientQueryMethodName=function(){var params=this.params;return"MusicArtist"===params.type?"getArtists":"Person"===params.type?"getPeople":"getItems"},ItemsView.prototype.refreshPrefixes=function(){var instance=this;this.getPrefixes().then(function(prefixes){instance.alphaPicker.setPrefixes(prefixes)})},ItemsView.prototype.getPrefixes=function(){var queryInfo=this.getQueryInfo(!1);if("downloads"===this.params.parentId)return Promise.resolve([]);var apiClient=connectionManager.getApiClient(this.params.serverId),query=queryInfo.query;query.SortBy=null,query.SortOrder=null,query.StartIndex=null,query.Limit=null,query.Fields=null,query.EnableImageTypes=null,query.ImageTypeLimit=null,query.NameStartsWithOrGreater=null;var method="MusicArtist"===this.params.type?"getArtistPrefixes":"getPrefixes";return query.IncludeItemTypes="getArtistPrefixes"==method?null:this.getPrefixQueryIncludeItemTypes().join(","),apiClient[method](apiClient.getCurrentUserId(),query).then(function(result){return result.map(function(i){return i.Name})})},ItemsView.prototype.getPrefixQueryIncludeItemTypes=function(){return this.getQueryIncludeItemTypes()},ItemsView.prototype.getQueryIncludeItemTypes=function(){var params=this.params;return"MusicArtist"===params.type||"Person"===params.type?[]:this.getItemTypes()},ItemsView.prototype.getBaseQuery=function(item){var params=this.params,parentId=params.parentId,sortValues=this.getSortValues(),fields="BasicSyncInfo",settings=this.getViewSettings();"primary"===settings.imageType&&(fields+=",PrimaryImageAspectRatio"),settings.showYear&&(fields+=",ProductionYear",fields+=",Status,EndDate");var imageTypes="Primary,Backdrop,Thumb";"banner"===settings.imageType?imageTypes+=",Banner":"disc"===settings.imageType?imageTypes+=",Disc":"logo"===settings.imageType&&(imageTypes+=",Logo");var query={SortBy:sortValues.sortBy,SortOrder:sortValues.sortOrder,IncludeItemTypes:this.getQueryIncludeItemTypes().join(",")||null,Fields:fields,ImageTypeLimit:1,EnableImageTypes:imageTypes,StartIndex:0,Limit:this.enableVirtualData()?this.virtualChunkSize():null,ParentId:parentId};return item&&("MusicGenre"===item.Type?query.IncludeItemTypes="MusicAlbum":"GameGenre"===item.Type?query.IncludeItemTypes="Game":"movies"===item.CollectionType?query.IncludeItemTypes="Movie":"tvshows"===item.CollectionType?query.IncludeItemTypes="Series":"Genre"===item.Type?query.IncludeItemTypes="Movie,Series,Video":"Person"===item.Type&&(query.IncludeItemTypes=params.type)),"Program"===params.type&&(query.HasAired=!1,this.enableVirtualScrolling()||(query.Limit=300)),"true"===params.IsFavorite&&(query.IsFavorite=!0),"true"===params.IsMovie?query.IsMovie=!0:"false"===params.IsMovie&&(query.IsMovie=!1),"true"===params.IsSeries?query.IsSeries=!0:"false"===params.IsSeries&&(query.IsSeries=!1),"true"===params.IsNews?query.IsNews=!0:"false"===params.IsNews&&(query.IsNews=!1),"true"===params.IsSports?query.IsSports=!0:"false"===params.IsSports&&(query.IsSports=!1),"true"===params.IsKids?query.IsKids=!0:"false"===params.IsKids&&(query.IsKids=!1),"true"===params.IsAiring?query.IsAiring=!0:"false"===params.IsAiring&&(query.IsAiring=!1),params.genreId&&(query.GenreIds=params.genreId),item&&("Studio"===item.Type?(query.StudioIds=item.Id,query.Recursive=!0):"Tag"===item.Type?(query.TagIds=item.Id,query.Recursive=!0):"Genre"===item.Type||"GameGenre"===item.Type||"MusicGenre"===item.Type?(query.GenreIds=item.Id,query.Recursive=!0):"Person"===item.Type&&(query.PersonIds=item.Id,query.Recursive=!0)),params.artistId&&(query.ArtistIds=params.artistId),params.albumArtistId&&(query.AlbumArtistIds=params.albumArtistId),params.type&&(query.Recursive=!0),query},ItemsView.prototype.getQueryInfo=function(enableFilters){var hasFilters,query=this.getBaseQuery(this.currentItem),queryFilters=[];if(!1!==enableFilters){var filters=this.getFilters();filters.SeriesStatus&&(query.SeriesStatus=filters.SeriesStatus,hasFilters=!0),filters.IsPlayed&&(queryFilters.push("IsPlayed"),hasFilters=!0),filters.IsUnplayed&&(queryFilters.push("IsUnplayed"),hasFilters=!0),filters.IsFavorite&&(queryFilters.push("IsFavorite"),hasFilters=!0),filters.IsResumable&&(queryFilters.push("IsResumable"),hasFilters=!0),filters.Containers&&(hasFilters=!0,query.Containers=filters.Containers),filters.AudioCodecs&&(hasFilters=!0,query.AudioCodecs=filters.AudioCodecs),filters.VideoCodecs&&(hasFilters=!0,query.VideoCodecs=filters.VideoCodecs),filters.SubtitleCodecs&&(hasFilters=!0,query.SubtitleCodecs=filters.SubtitleCodecs),filters.GenreIds&&(hasFilters=!0,query.GenreIds=filters.GenreIds),filters.OfficialRatings&&(hasFilters=!0,query.OfficialRatings=filters.OfficialRatings),filters.StudioIds&&(hasFilters=!0,query.StudioIds=filters.StudioIds),filters.TagIds&&(hasFilters=!0,query.TagIds=filters.TagIds),filters.Tags&&(hasFilters=!0,query.Tags=filters.Tags),filters.Years&&(hasFilters=!0,query.Years=filters.Years),filters.Is4K&&(hasFilters=query.Is4K=!0),filters.IsHD&&(hasFilters=query.IsHD=!0),filters.IsSD&&(hasFilters=!(query.IsHD=!1)),filters.Is3D&&(hasFilters=query.Is3D=!0),null!=filters.HasSubtitles&&(query.HasSubtitles=filters.HasSubtitles,hasFilters=!0),null!=filters.HasTrailer&&(query.HasTrailer=filters.HasTrailer,hasFilters=!0),null!=filters.HasSpecialFeature&&(query.HasSpecialFeature=filters.HasSpecialFeature,hasFilters=!0),null!=filters.HasThemeSong&&(query.HasThemeSong=filters.HasThemeSong,hasFilters=!0),null!=filters.HasThemeVideo&&(query.HasThemeVideo=filters.HasThemeVideo,hasFilters=!0),null!=filters.HasOverview&&(query.HasOverview=filters.HasOverview,hasFilters=!0),null!=filters.HasImdbId&&(query.HasImdbId=filters.HasImdbId,hasFilters=!0),null!=filters.HasTvdbId&&(query.HasTvdbId=filters.HasTvdbId,hasFilters=!0),null!=filters.HasTmdbId&&(query.HasTmdbId=filters.HasTmdbId,hasFilters=!0),null!=filters.IsLocked&&(query.IsLocked=filters.IsLocked,hasFilters=!0)}return query.Filters=queryFilters.length?queryFilters.join(","):null,this.getViewSettings().groupItemsIntoCollections&&(query.GroupItemsIntoCollections=!0),{query:query,hasFilters:hasFilters}},ItemsView.prototype.getFilters=function(){var basekey=this.getSettingsKey();return{IsPlayed:"true"===userSettings.getFilter(basekey+"-filter-IsPlayed"),IsUnplayed:"true"===userSettings.getFilter(basekey+"-filter-IsUnplayed"),IsFavorite:"true"===userSettings.getFilter(basekey+"-filter-IsFavorite"),IsResumable:"true"===userSettings.getFilter(basekey+"-filter-IsResumable"),Is4K:"true"===userSettings.getFilter(basekey+"-filter-Is4K"),IsHD:"true"===userSettings.getFilter(basekey+"-filter-IsHD"),IsSD:"true"===userSettings.getFilter(basekey+"-filter-IsSD"),Is3D:"true"===userSettings.getFilter(basekey+"-filter-Is3D"),SeriesStatus:userSettings.getFilter(basekey+"-filter-SeriesStatus"),HasSubtitles:userSettings.getFilter(basekey+"-filter-HasSubtitles"),HasTrailer:userSettings.getFilter(basekey+"-filter-HasTrailer"),HasSpecialFeature:userSettings.getFilter(basekey+"-filter-HasSpecialFeature"),HasThemeSong:userSettings.getFilter(basekey+"-filter-HasThemeSong"),HasThemeVideo:userSettings.getFilter(basekey+"-filter-HasThemeVideo"),HasOverview:userSettings.getFilter(basekey+"-filter-HasOverview"),HasImdbId:userSettings.getFilter(basekey+"-filter-HasImdbId"),HasTvdbId:userSettings.getFilter(basekey+"-filter-HasTvdbId"),HasTmdbId:userSettings.getFilter(basekey+"-filter-HasTmdbId"),IsLocked:userSettings.getFilter(basekey+"-filter-IsLocked"),GenreIds:userSettings.getFilter(basekey+"-filter-GenreIds"),StudioIds:userSettings.getFilter(basekey+"-filter-StudioIds"),Tags:userSettings.getFilter(basekey+"-filter-Tags"),TagIds:userSettings.getFilter(basekey+"-filter-TagIds"),OfficialRatings:userSettings.getFilter(basekey+"-filter-OfficialRatings"),Containers:userSettings.getFilter(basekey+"-filter-Containers"),AudioCodecs:userSettings.getFilter(basekey+"-filter-AudioCodecs"),VideoCodecs:userSettings.getFilter(basekey+"-filter-VideoCodecs"),SubtitleCodecs:userSettings.getFilter(basekey+"-filter-SubtitleCodecs"),Years:userSettings.getFilter(basekey+"-filter-Years")}},ItemsView.prototype.afterItemsRefreshed=function(result){var items=result.Items||result,totalRecordCount=result.TotalRecordCount||items.length;!function(instance,numItems){if(instance.alphaPicker){var alphaPicker=instance.alphaPickerElement;if(alphaPicker){var values=instance.getSortValues(),parentWithSidePadding=getParentWithSidePadding(instance);"SortName"===values.sortBy&&"Ascending"===values.sortOrder&&30<numItems?(alphaPicker.classList.remove("hide"),layoutManager.tv?(parentWithSidePadding.classList.add("padded-left-withalphapicker"),parentWithSidePadding.classList.remove("padded-right-withalphapicker")):(parentWithSidePadding.classList.add("padded-right-withalphapicker"),parentWithSidePadding.classList.remove("padded-left-withalphapicker")),instance.refreshPrefixes()):(alphaPicker.classList.add("hide"),parentWithSidePadding.classList.remove("padded-left-withalphapicker"),parentWithSidePadding.classList.remove("padded-right-withalphapicker"))}}}(this,totalRecordCount),function(instance,view,totalRecordCount){var elem=view.querySelector(".listTotalRecordCount");elem&&(!1!==instance.enableTotalRecordCountDisplay?elem.innerHTML=instance.getItemCountText(totalRecordCount):elem.classList.add("hide"))}(this,this.view,totalRecordCount),totalRecordCount||this.setEmptyListState()},ItemsView.prototype.getEmptyListMessage=function(){return this.hasFilters?Promise.resolve(globalize.translate("NoItemsMatchingFound")):Promise.resolve(globalize.translate("NoItemsFound"))},ItemsView.prototype.setEmptyListState=function(){this.getEmptyListMessage().then(function(html){html='<div class="flex padded-top align-items-center justify-content-center flex-grow align-items-flex-start">'+html,html+="</div>",this.itemsContainer.innerHTML=html}.bind(this))},ItemsView.prototype.setTitle=function(){var title=function(params,item){return"downloads"===params.parentId?globalize.translate("Downloads"):"Recordings"===params.type?globalize.translate("Recordings"):"Program"===params.type?"true"===params.IsMovie?globalize.translate("Movies"):"true"===params.IsSports?globalize.translate("Sports"):"true"===params.IsKids?globalize.translate("HeaderForKids"):"true"===params.IsAiring?globalize.translate("HeaderOnNow"):"true"===params.IsSeries?globalize.translate("Shows"):"true"===params.IsNews?globalize.translate("News"):globalize.translate("Program"):"nextup"===params.type?globalize.translate("HeaderNextUp"):"favoritemovies"===params.type?globalize.translate("FavoriteMovies"):item||("Movie"===params.type?globalize.translate("Movies"):"Series"===params.type?globalize.translate("Shows"):"Season"===params.type?globalize.translate("Seasons"):"Episode"===params.type?globalize.translate("Episodes"):"MusicArtist"===params.type?globalize.translate("Artists"):"MusicAlbum"===params.type?globalize.translate("Albums"):"Audio"===params.type?globalize.translate("Songs"):"Game"===params.type?globalize.translate("Games"):"Video"===params.type?globalize.translate("Videos"):void 0)}(this.params,this.currentItem);appHeader.setTitle(title||"")},ItemsView.prototype.getSortValues=function(){var sortOrder,basekey=this.getSettingsKey(),sortBy=userSettings.getFilter(basekey+"-sortby");return sortOrder=sortBy?"Descending"===userSettings.getFilter(basekey+"-sortorder")?"Descending":"Ascending":getDetaultSortOrder(sortBy=this.getDefaultSortBy()),{sortBy:sortBy,sortOrder:sortOrder}},ItemsView.prototype.getDefaultSortBy=function(){var params=this.params,sortNameOption=this.getNameSortOption(params);return"Program"===params.type?"StartDate":params.type?sortNameOption.value:"IsFolder,"+sortNameOption.value},ItemsView.prototype.getSortMenuOptions=function(){var sortBy=[],params=this.params;if("downloads"===params.parentId)return sortBy;if("nextup"===params.type)return sortBy;"Program"===params.type&&sortBy.push({name:globalize.translate("AirDate"),value:"StartDate"});var option=this.getNameSortOption(params);return option&&sortBy.push(option),(option=this.getCommunityRatingSortOption())&&sortBy.push(option),(option=this.getCriticRatingSortOption())&&sortBy.push(option),"Program"!==params.type&&sortBy.push({name:globalize.translate("DateAdded"),value:"DateCreated,SortName"}),(option=this.getDatePlayedSortOption())&&sortBy.push(option),params.type||(option=this.getNameSortOption(params),sortBy.push({name:globalize.translate("Folders"),value:"IsFolder,"+option.value})),sortBy.push({name:globalize.translate("ParentalRating"),value:"OfficialRating,SortName"}),(option=this.getPlayCountSortOption())&&sortBy.push(option),sortBy.push({name:globalize.translate("ReleaseDate"),value:"ProductionYear,PremiereDate,SortName"}),sortBy.push({name:globalize.translate("Runtime"),value:"Runtime,SortName"}),sortBy},ItemsView.prototype.getNameSortOption=function(params){return"Episode"===params.type?{name:globalize.translate("Title"),value:"SeriesName,SortName"}:{name:globalize.translate("Title"),value:"SortName"}},ItemsView.prototype.getPlayCountSortOption=function(){var params=this.params;return"Program"===params.type?null:"downloads"===params.parentId?null:{name:globalize.translate("PlayCount"),value:"PlayCount,SortName"}},ItemsView.prototype.getDatePlayedSortOption=function(){var params=this.params;return"Program"===params.type?null:"downloads"===params.parentId?null:{name:globalize.translate("DatePlayed"),value:"DatePlayed,SortName"}},ItemsView.prototype.getCriticRatingSortOption=function(){var params=this.params;return"Program"===params.type?null:"downloads"===params.parentId?null:{name:globalize.translate("CriticRating"),value:"CriticRating,SortName"}},ItemsView.prototype.getCommunityRatingSortOption=function(){return{name:globalize.translate("CommunityRating"),value:"CommunityRating,SortName"}},ItemsView.prototype.getVisibleFilters=function(){var filters=[],params=this.params;return"downloads"===params.parentId||"nextup"===params.type||("Program"===params.type?(filters.push("Genres"),filters.push("OfficialRatings")):"Recordings"===params.type?(filters.push("IsUnplayed"),filters.push("IsPlayed"),params.IsFavorite||filters.push("IsFavorite"),params.genreId||filters.push("Genres"),params.studioId||filters.push("Studios"),params.tagId||filters.push("Tags"),filters.push("OfficialRatings"),filters.push("Containers"),filters.push("Years"),filters.push("AudioCodecs"),filters.push("VideoCodecs"),filters.push("SubtitleCodecs"),filters.push("IsResumable"),filters.push("HasSubtitles"),filters.push("HasTrailer"),filters.push("HasSpecialFeature"),filters.push("HasThemeSong"),filters.push("HasThemeVideo"),filters.push("HasOverview"),filters.push("IsLocked")):(filters.push("IsUnplayed"),filters.push("IsPlayed"),params.IsFavorite||filters.push("IsFavorite"),params.genreId||filters.push("Genres"),params.studioId||filters.push("Studios"),params.tagId||filters.push("Tags"),filters.push("OfficialRatings"),filters.push("Containers"),filters.push("Years"),filters.push("AudioCodecs"),filters.push("VideoCodecs"),filters.push("SubtitleCodecs"),filters.push("IsResumable"),filters.push("HasSubtitles"),filters.push("HasTrailer"),filters.push("HasSpecialFeature"),filters.push("HasThemeSong"),filters.push("HasThemeVideo"),filters.push("HasOverview"),filters.push("IsLocked"),filters.push("HasImdbId"))),filters},ItemsView.prototype.setFilterStatus=function(hasFilters){this.hasFilters=hasFilters;var filterButtons=this.filterButtons;if(filterButtons.length)for(var i=0,length=filterButtons.length;i<length;i++){var btnFilter=filterButtons[i],bubble=btnFilter.querySelector(".filterButtonBubble");if(!bubble){if(!hasFilters)continue;btnFilter.insertAdjacentHTML("afterbegin",'<div class="filterButtonBubble">!</div>'),btnFilter.classList.add("btnFilterWithBubble"),bubble=btnFilter.querySelector(".filterButtonBubble")}hasFilters?bubble.classList.remove("hide"):bubble.classList.add("hide")}},ItemsView.prototype.enableVirtualScrolling=function(){return this.itemsContainer.hasAttribute("data-virtualscrolllayout")&&!browser.msie},ItemsView.prototype.enableVirtualData=function(){return this.enableVirtualScrolling()},ItemsView.prototype.virtualChunkSize=function(){return 50},ItemsView.prototype.getFilterMenuOptions=function(){var params=this.params;return{IsAiring:params.IsAiring,IsMovie:params.IsMovie,IsSports:params.IsSports,IsKids:params.IsKids,IsNews:params.IsNews,IsSeries:params.IsSeries,Recursive:this.queryRecursive}},ItemsView.prototype.getVisibleViewSettings=function(){var params=this.params;if("downloads"===params.parentId)return[];var item=this.currentItem,fields=["showTitle"];return"Person"!==params.type&&"MusicArtist"!==params.type&&"nextup"!==params.type&&"Program"!==params.type&&fields.push("showYear"),item&&("PhotoAlbum"===item.Type||"ChannelFolderItem"===item.Type)||fields.push("imageType"),fields.push("viewType"),fields},ItemsView.prototype.getViewSettings=function(){var basekey=this.getSettingsKey(),params=this.params,item=this.currentItem,showTitle=userSettings.get(basekey+"-showTitle");"true"===showTitle?showTitle=!0:"false"===showTitle?showTitle=!1:item&&"PhotoAlbum"===item.Type||(showTitle=!0);var imageType=userSettings.get(basekey+"-imageType");return imageType||"nextup"===params.type&&(imageType="thumb"),{showTitle:showTitle,showYear:"Program"!==params.type&&"false"!==userSettings.get(basekey+"-showYear"),imageType:imageType||"primary",viewType:userSettings.get(basekey+"-viewType")||"images"}},ItemsView.prototype.getItemTypes=function(){var params=this.params;return"nextup"===params.type?["Episode"]:"Recordings"===params.type?["Episode","Video","Movie"]:params.type?params.type.split(","):[]},ItemsView.prototype.getItemCountText=function(numItems){return 1===numItems?globalize.translate("ValueOneItem"):globalize.translate("ItemCount",numItems)},ItemsView.prototype.getSettingsKey=function(){var values=[];values.push("items");var params=this.params;return params.type?values.push(params.type):params.parentId&&values.push(params.parentId),params.IsAiring&&values.push("IsAiring"),params.IsMovie&&values.push("IsMovie"),params.IsKids&&values.push("IsKids"),params.IsSports&&values.push("IsSports"),params.IsNews&&values.push("IsNews"),params.IsSeries&&values.push("IsSeries"),params.IsFavorite&&values.push("IsFavorite"),params.genreId&&values.push("Genre"),params.gameGenreId&&values.push("GameGenre"),params.musicGenreId&&values.push("MusicGenre"),params.studioId&&values.push("Studio"),params.tagId&&values.push("Tag"),params.personId&&values.push("Person"),params.parentId&&values.push("Folder"),values.join("-")},ItemsView});