define(["backdrop","userSettings","connectionManager","layoutManager"],function(backdrop,userSettings,connectionManager,layoutManager){"use strict";document.addEventListener("viewshow",function(e){var detail=e.detail,backdropItemTypes=detail.backdropItemTypes;if(backdropItemTypes&&!layoutManager.tv&&userSettings.enableBackdrops()){var params=detail.params,parentId=params?params.parentId:null;!function(view,type,parentId){var apiClient=connectionManager.currentApiClient();apiClient&&(view.backdropItems?backdrop.setBackdrops(view.backdropItems):function(view,apiClient,types,parentId){var options={SortBy:"IsFavoriteOrLiked,Random",Limit:20,Recursive:!0,IncludeItemTypes:types,ImageTypes:"Backdrop",ParentId:parentId,EnableTotalRecordCount:!1,ImageTypeLimit:1,EnableImageTypes:"Backdrop"};return apiClient.getItems(apiClient.getCurrentUserId(),options)}(0,apiClient,type,parentId).then(function(result){if(result.Items.length){var items=result.Items;view.backdropItems=items,backdrop.setBackdrops(items)}else backdrop.clear()}))}(e.target,backdropItemTypes,parentId)}}),document.addEventListener("viewdestroy",function(e){var view=e.target;view.backdropItems&&(view.backdropItems=null)})});