define(["datetime","imageLoader","connectionManager","itemHelper","focusManager","indicators","globalize","layoutManager","apphost","dom","browser","playbackManager","itemShortcuts","humanedate","css!./card","paper-icon-button-light","programStyles","embyProgressBarStyle","emby-checkbox","emby-playstatebutton","emby-ratingbutton"],function(datetime,imageLoader,connectionManager,itemHelper,focusManager,indicators,globalize,layoutManager,appHost,dom,browser,playbackManager,itemShortcuts,humanedate){"use strict";window.devicePixelRatio;var enableFocusTransfrom=!(browser.tv||browser.xboxOne||browser.ps4||browser.edge),supportsNativeLazyLoading="loading"in HTMLImageElement.prototype;function getCardsHtml(items,options){return 1===arguments.length&&(items=(options=arguments[0]).items),buildCardsHtmlInternal(items,options)}supportsNativeLazyLoading=!1;var cachedWidths={};function setCardData(items,options){var shape=options.shape||"auto",primaryImageAspectRatio=imageLoader.getPrimaryImageAspectRatio(items,options);if("auto"===shape||"autooverflow"===shape){shape=null,primaryImageAspectRatio&&(shape=3<=primaryImageAspectRatio?"banner":1.4<=primaryImageAspectRatio?"backdrop":1.2<primaryImageAspectRatio?"fourThree":.71<primaryImageAspectRatio?"square":"portrait"),shape=shape||(options.defaultShape||function(items){var firstItem=items[0];if(firstItem)switch(firstItem.Type){case"Movie":case"SeriesTimer":return"portrait";case"Episode":case"Program":case"Video":return"backdrop"}return"square"}(items))}if("auto"===options.preferThumb&&(options.preferThumb="backdrop"===shape),options.uiAspect=function(shape){if(shape){if(-1!==(shape=shape.toLowerCase()).indexOf("portrait"))return 2/3;if(-1!==shape.indexOf("backdrop"))return 16/9;if(-1!==shape.indexOf("square"))return 1;if(-1!==shape.indexOf("fourthree"))return 4/3;if(-1!==shape.indexOf("banner"))return 1e3/185}return null}(shape),options.primaryImageAspectRatio=primaryImageAspectRatio,!options.width&&options.widths&&(options.width=options.widths[shape]),options.rows&&"number"!=typeof options.rows&&(options.rows=options.rows[shape]),!options.width){var screenWidth=dom.getWindowSize().innerWidth,cardClass="card "+shape+"Card";if(options.cardClass&&(cardClass+=" "+options.cardClass),options.width=function(shape,cardClass,screenWidth){var key=shape+screenWidth,width=cachedWidths[key];if(width)return width;var div=document.createElement("div");div.className="itemsContainer",layoutManager.tv&&div.classList.add("itemsContainer-tv"),div.style.visibility="hidden",div.innerHTML='<div class="'+cardClass+'"><div class="cardBox"><div class="cardScalable"></div></div></div>';var parent=document.body;return parent.appendChild(div),width=cachedWidths[key]=div.querySelector(".cardScalable").offsetWidth,parent.removeChild(div),width}(shape,cardClass,screenWidth),function(windowWidth){var screen=window.screen;return!!(screen&&20<screen.availWidth-windowWidth)}(screenWidth)){options.width=50*Math.round(options.width/50)}}var className="card";shape&&(className+=" "+shape+"Card"),!1===options.enableUserData&&(className+=" card-nouserdata"),options.cardClass&&(className+=" "+options.cardClass);var isLayoutTv=layoutManager.tv;isLayoutTv||(className+=" card-hoverable");var tagName,isSingleClickElement=(isLayoutTv||!1===options.hoverMenu)&&"none"!==options.action;enableFocusTransfrom&&isLayoutTv||(className+=" card-nofocustransform"),isSingleClickElement?(tagName="button",className+=" itemAction"):(tagName="div",layoutManager.tv||(className+=" focusable",options.addTabIndex=!0));var lineContents=[];lineContents.length=options.lines||(options.showTitle||options.showParentTitleOrTitle||options.showParentTitle?1:0);for(var i=0,length=lineContents.length;i<length;i++)lineContents[i]="&nbsp;";var lines=lineContents.length?getCardTextLines(lineContents,"cardText",!options.overlayText,!0,!1,lineContents.length):"",cardBoxClass=options.cardLayout?"cardBox visualCardBox":"cardBox";isLayoutTv&&(cardBoxClass+=enableFocusTransfrom?" cardBox-focustransform cardBox-withfocuscontent":" cardBox-withfocuscontent-large",options.cardLayout&&(cardBoxClass+=" card-focuscontent",enableFocusTransfrom||(cardBoxClass+=" card-focuscontent-large"))),isSingleClickElement||options.centerPlayButton||(cardBoxClass+=" cardBox-touchzoom"),!lineContents.length||options.overlayText||options.cardLayout||(cardBoxClass+=" cardBox-bottompadded");var cardPadderClass="cardPadder-"+shape,cardScalableClass="cardScalable";isSingleClickElement&&!options.cardLayout&&(cardScalableClass+=" card-focuscontent",enableFocusTransfrom||(cardScalableClass+=" card-focuscontent-large"));var cardContentClass="cardContent cardImageContainer";options.cardLayout||(cardContentClass+=" cardContent-shadow"),options.paddedImage&&(cardContentClass+=" paddedImage"),options.defaultBackground&&(cardContentClass+=" defaultCardBackground defaultCardBackground0"),options.imageClass&&(cardContentClass+=" "+options.imageClass),options.separateCardPadder=isSingleClickElement&&!enableFocusTransfrom;var innerHTML='<div class="'+cardBoxClass+'">';options.separateCardPadder?innerHTML+='<div class="'+cardScalableClass+'"><div class="'+cardPadderClass+'"></div>':innerHTML+='<div class="'+cardScalableClass+" "+cardPadderClass+'">',innerHTML+='<div class="'+cardContentClass+'"></div></div>'+lines+"</div>",options.defaultIcon=options.defaultIcon||!1,options.moreTitle=globalize.translate("More"),options.multiSelectTitle=globalize.translate("MultiSelect"),options.templateInnerHTML=innerHTML,options.cardPadderClass=cardPadderClass,options.cardScalableClass=cardScalableClass,options.tagName=tagName,options.shape=shape,options.className=className,options.isSingleClickElement=isSingleClickElement,options.cardContentClass=cardContentClass,options.cardBoxClass=cardBoxClass}function buildCardsHtmlInternal(items,options){setCardData(items,options);for(var hasOpenRow,html="",itemsInRow=0,rows=options.rows,i=0,length=items.length;i<length;i++){rows&&0===itemsInRow&&(hasOpenRow&&(html+="</div>",hasOpenRow=!1),html+='<div class="cardColumn">',hasOpenRow=!0),html+=getCardHtml(items[i],i,options),itemsInRow++,rows&&rows<=itemsInRow&&(html+="</div>",hasOpenRow=!1,itemsInRow=0)}return hasOpenRow&&(html+="</div>"),html}function getImageUrl(item,apiClient,options,shape){var uiAspect=options.uiAspect;if(item.ImageUrl)return{imgUrl:item.ImageUrl};item=options.showCurrentProgramImage?item.CurrentProgram||item:item.ProgramInfo||item;var width=options.width,height=null,primaryImageAspectRatio=item.PrimaryImageAspectRatio,forceName=!1,imgUrl=null,coverImage=!1,imageTags=item.ImageTags;return options.preferThumb&&imageTags&&imageTags.Thumb?imgUrl=apiClient.getScaledImageUrl(item.Id,{type:"Thumb",maxWidth:width,tag:imageTags.Thumb}):(options.preferBanner||"banner"===shape)&&imageTags&&imageTags.Banner?imgUrl=apiClient.getScaledImageUrl(item.Id,{type:"Banner",maxWidth:width,tag:imageTags.Banner}):options.preferDisc&&imageTags&&imageTags.Disc?imgUrl=apiClient.getScaledImageUrl(item.Id,{type:"Disc",maxWidth:width,tag:imageTags.Disc}):options.preferLogo&&imageTags&&imageTags.Logo?imgUrl=apiClient.getScaledImageUrl(item.Id,{type:"Logo",maxWidth:width,tag:imageTags.Logo}):options.preferLogo&&item.ParentLogoImageTag&&item.ParentLogoItemId?imgUrl=apiClient.getScaledImageUrl(item.ParentLogoItemId,{type:"Logo",maxWidth:width,tag:item.ParentLogoImageTag}):options.showChannelLogo&&item.ChannelPrimaryImageTag&&item.ChannelId?imgUrl=apiClient.getScaledImageUrl(item.ChannelId,{type:"Primary",maxWidth:width,tag:item.ChannelPrimaryImageTag}):options.preferThumb&&item.ParentThumbItemId&&!1!==options.inheritThumb&&"Photo"!==item.MediaType?imgUrl=apiClient.getScaledImageUrl(item.ParentThumbItemId,{type:"Thumb",maxWidth:width,tag:item.ParentThumbImageTag}):options.preferThumb&&item.BackdropImageTags&&item.BackdropImageTags.length?(imgUrl=apiClient.getScaledImageUrl(item.Id,{type:"Backdrop",maxWidth:width,tag:item.BackdropImageTags[0]}),forceName=!0):options.preferThumb&&item.ParentBackdropImageTags&&item.ParentBackdropImageTags.length&&!1!==options.inheritThumb&&"Episode"===item.Type?(imgUrl=apiClient.getScaledImageUrl(item.ParentBackdropItemId,{type:"Backdrop",maxWidth:width,tag:item.ParentBackdropImageTags[0]}),options.preferThumb&&!1!==options.showTitle&&(forceName=!0)):imageTags&&imageTags.Primary?(height=width&&primaryImageAspectRatio?Math.round(width/primaryImageAspectRatio):null,imgUrl=apiClient.getScaledImageUrl(item.Id,{type:"Primary",maxHeight:height,maxWidth:width,tag:imageTags.Primary}),options.preferThumb&&!1!==options.showTitle&&(forceName=!0),primaryImageAspectRatio&&uiAspect&&(coverImage=Math.abs(primaryImageAspectRatio-uiAspect)/uiAspect<=.28)):item.ImageTag&&"Plugin"===item.Type?(imgUrl=apiClient.getUrl("Plugins/"+item.Id+"/Thumb",{maxHeight:height,maxWidth:width,tag:item.ImageTag}),primaryImageAspectRatio&&uiAspect&&(coverImage=Math.abs(primaryImageAspectRatio-uiAspect)/uiAspect<=.28)):item.PrimaryImageTag?(height=width&&primaryImageAspectRatio?Math.round(width/primaryImageAspectRatio):null,"User"===item.Type?imgUrl=apiClient.getUserImageUrl(item.Id,{maxHeight:height,maxWidth:width,tag:item.PrimaryImageTag,type:"Primary"}):(imgUrl=apiClient.getScaledImageUrl(item.PrimaryImageItemId||item.Id||item.ItemId,{type:"Primary",maxHeight:height,maxWidth:width,tag:item.PrimaryImageTag}),options.preferThumb&&!1!==options.showTitle&&(forceName=!0)),primaryImageAspectRatio&&uiAspect&&(coverImage=Math.abs(primaryImageAspectRatio-uiAspect)/uiAspect<=.28)):item.ParentThumbItemId&&!1!==options.inheritThumb&&uiAspect&&1.4<=uiAspect&&"Photo"!==item.MediaType?imgUrl=apiClient.getScaledImageUrl(item.ParentThumbItemId,{type:"Thumb",maxWidth:width,tag:item.ParentThumbImageTag}):item.ParentPrimaryImageTag?imgUrl=apiClient.getScaledImageUrl(item.ParentPrimaryImageItemId,{type:"Primary",maxWidth:width,tag:item.ParentPrimaryImageTag}):item.SeriesPrimaryImageTag?imgUrl=apiClient.getScaledImageUrl(item.SeriesId,{type:"Primary",maxWidth:width,tag:item.SeriesPrimaryImageTag}):item.AlbumId&&item.AlbumPrimaryImageTag?(width=primaryImageAspectRatio?Math.round(height*primaryImageAspectRatio):null,imgUrl=apiClient.getScaledImageUrl(item.AlbumId,{type:"Primary",maxHeight:height,maxWidth:width,tag:item.AlbumPrimaryImageTag}),primaryImageAspectRatio&&uiAspect&&(coverImage=Math.abs(primaryImageAspectRatio-uiAspect)/uiAspect<=.28)):"Season"===item.Type&&imageTags&&imageTags.Thumb?imgUrl=apiClient.getScaledImageUrl(item.Id,{type:"Thumb",maxWidth:width,tag:imageTags.Thumb}):item.BackdropImageTags&&item.BackdropImageTags.length?imgUrl=apiClient.getScaledImageUrl(item.Id,{type:"Backdrop",maxWidth:width,tag:item.BackdropImageTags[0]}):imageTags&&imageTags.Thumb?imgUrl=apiClient.getScaledImageUrl(item.Id,{type:"Thumb",maxWidth:width,tag:imageTags.Thumb}):item.ParentThumbItemId&&!1!==options.inheritThumb?imgUrl=apiClient.getScaledImageUrl(item.ParentThumbItemId,{type:"Thumb",maxWidth:width,tag:item.ParentThumbImageTag}):item.ParentBackdropImageTags&&item.ParentBackdropImageTags.length&&!1!==options.inheritThumb?imgUrl=apiClient.getScaledImageUrl(item.ParentBackdropItemId,{type:"Backdrop",maxWidth:width,tag:item.ParentBackdropImageTags[0]}):item.PrimaryImageItemId?imgUrl=apiClient.getScaledImageUrl(item.PrimaryImageItemId,{type:"Primary",maxHeight:height,maxWidth:width}):item.UserPrimaryImageTag&&(imgUrl=apiClient.getUserImageUrl(item.UserId,{maxHeight:height,maxWidth:width,tag:item.UserPrimaryImageTag,type:"Primary"})),{imgUrl:imgUrl,forceName:forceName,coverImage:coverImage}}var refreshIndicatorLoaded,numRandomColors=5;function getDefaultColorIndex(str){if(str){for(var charIndex=Math.floor(str.length/2),character=String(str.substr(charIndex,1).charCodeAt()),sum=0,i=0;i<character.length;i++)sum+=parseInt(character.charAt(i));return String(sum).substr(-1)%numRandomColors+1}return function(min,max){return Math.floor(Math.random()*(max-min+1))+min}(1,numRandomColors)}function getCardTextLines(lines,cssClass,forceLines,isOuterFooter,addRightMargin,maxLines){var i,length,html="",valid=0,currentCssClass=cssClass;for(i=0,length=lines.length;i<length;i++){currentCssClass=cssClass;var text=lines[i];if(0<valid&&isOuterFooter?currentCssClass+=" cardText-secondary":0===valid&&isOuterFooter&&(currentCssClass+=" cardText-first"),addRightMargin&&(currentCssClass+=" cardText-rightmargin"),text&&(html+='<div class="'+currentCssClass+'">',html+=text,html+="</div>",valid++,maxLines&&maxLines<=valid))break}if(forceLines)for(length=maxLines||Math.min(lines.length,maxLines||lines.length);valid<length;)currentCssClass=cssClass,0<valid&&isOuterFooter&&(currentCssClass+=" cardText-secondary"),html+='<div class="'+currentCssClass+'">&nbsp;</div>',valid++;return html}function isUsingLiveTvNaming(itemType){return"Program"===itemType||"Timer"===itemType||"Recording"===itemType}function getAirTimeText(item,showAirDateTime,showAirEndTime){var airTimeText="";if(item.StartDate)try{var date=datetime.parseISO8601Date(item.StartDate);showAirDateTime&&(airTimeText+=datetime.toLocaleDateString(date,{weekday:"short",month:"short",day:"numeric"})+" "),airTimeText+=datetime.getDisplayTime(date),item.EndDate&&showAirEndTime&&(date=datetime.parseISO8601Date(item.EndDate),airTimeText+=" &ndash; "+datetime.getDisplayTime(date))}catch(e){console.log("Error parsing date: "+item.StartDate)}return airTimeText}function getCardFooterText(item,options,showTitle,forceName,overlayText,imgUrl,footerClass,progressHtml,logoUrl,isOuterFooter){var itemType=item.Type,html="";logoUrl&&(html+='<div class="lazy cardFooterLogo" loading="lazy" style="background-image:url('+logoUrl+');"></div>');var showOtherText=isOuterFooter?!overlayText:overlayText;isOuterFooter&&options.cardLayout&&!layoutManager.tv&&!1!==options.cardFooterAside&&"Program"!==item.Type&&item.Id&&(html+='<button type="button" is="paper-icon-button-light" title="'+globalize.translate("More")+'" class="itemAction btnCardOptions cardText-secondary" data-action="menu"><i class="md-icon">&#xE5D3;</i></button>');var titleAdded,cssClass=options.centerText?"cardText cardTextCentered":"cardText",lines=[],parentTitleUnderneath="MusicAlbum"===itemType||"Audio"===itemType||"MusicVideo"===itemType||"Game"===itemType,serverId=item.ServerId||options.serverId;if(showOtherText&&(options.showParentTitle||options.showParentTitleOrTitle||forceName&&options.seriesNameInPlaceHolderName)&&!parentTitleUnderneath)if(isOuterFooter&&"Episode"===itemType&&item.SeriesName)item.SeriesId?lines.push(getTextActionButton(options,{Id:item.SeriesId,ServerId:serverId,Name:item.SeriesName,Type:"Series",IsFolder:!0})):lines.push(dom.htmlEncode(item.SeriesName));else if(isUsingLiveTvNaming(itemType))lines.push(dom.htmlEncode(item.Name)),item.EpisodeTitle||(titleAdded=!0);else{var parentTitle=item.SeriesName||item.Series||item.Album||(item.AlbumArtist?item.AlbumArtist.Name||item.AlbumArtist:null)||item.GameSystem||"";(parentTitle||showTitle)&&lines.push(dom.htmlEncode(parentTitle))}var showMediaTitle=showTitle&&!titleAdded||options.showParentTitleOrTitle&&!lines.length;if(showMediaTitle||titleAdded||!(showTitle||forceName&&!options.seriesNameInPlaceHolderName)||(showMediaTitle=!0),showMediaTitle){var name="auto"!==options.showTitle||item.IsFolder||"Photo"!==item.MediaType?itemHelper.getDisplayName(item,{includeParentInfo:options.includeParentInfoInTitle,channelNumberFirst:options.channelNumberFirst}):"";overlayText?lines.push(dom.htmlEncode(name)):lines.push(getTextActionButton(options,item,name,serverId,options.parentId,!0))}if(showOtherText){if(options.showParentTitle&&parentTitleUnderneath&&(isOuterFooter&&item.AlbumArtists&&item.AlbumArtists.length&&"MusicAlbum"===itemType?(item.AlbumArtists[0].Type="MusicArtist",item.AlbumArtists[0].IsFolder=!0,lines.push(getTextActionButton(options,item.AlbumArtists[0],null,serverId))):isOuterFooter&&item.ArtistItems&&item.ArtistItems.length?(item.ArtistItems[0].Type="MusicArtist",item.ArtistItems[0].IsFolder=!0,lines.push(getTextActionButton(options,item.ArtistItems[0],null,serverId))):isOuterFooter&&item.AlbumArtists&&item.AlbumArtists.length?(item.AlbumArtists[0].Type="MusicArtist",item.AlbumArtists[0].IsFolder=!0,lines.push(getTextActionButton(options,item.AlbumArtists[0],null,serverId))):isOuterFooter&&item.GameSystem&&item.GameSystemId?lines.push(getTextActionButton(options,{Id:item.GameSystemId,ServerId:serverId,Name:item.GameSystem,Type:"GameSystem",IsFolder:!0})):lines.push(dom.htmlEncode(isUsingLiveTvNaming(itemType)?item.Name:item.SeriesName||item.Series||item.Album||(item.AlbumArtist?item.AlbumArtist.Name||item.AlbumArtist:null)||item.GameSystem||""))),options.textLines)for(var additionalLines=options.textLines(item),i=0,length=additionalLines.length;i<length;i++)lines.push(additionalLines[i]);if(options.showYear)if("Series"===itemType)if("Continuing"===item.Status)lines.push(globalize.translate("SeriesYearToPresent",item.ProductionYear||""));else{var endYear=item.EndDate?datetime.parseISO8601Date(item.EndDate).getFullYear():null;endYear&&item.ProductionYear&&endYear!==item.ProductionYear?lines.push(item.ProductionYear+" &ndash; "+endYear):lines.push(item.ProductionYear||"")}else lines.push(item.ProductionYear||"");if(options.showRuntime&&(item.RunTimeTicks?lines.push(datetime.getDisplayRunningTime(item.RunTimeTicks)):lines.push("")),options.showAirTime&&lines.push(getAirTimeText(item,options.showAirDateTime,options.showAirEndTime)||""),options.showChannelName&&(item.ChannelId?lines.push(getTextActionButton(options,{Id:item.ChannelId,ServerId:serverId,Name:item.ChannelName,Type:"TvChannel",MediaType:item.MediaType,IsFolder:!1},item.ChannelName)):lines.push(item.ChannelName||"&nbsp;")),options.showCurrentProgramParentTitle&&"TvChannel"===itemType&&(item.CurrentProgram?lines.push(item.CurrentProgram.Name||""):lines.push("")),options.showCurrentProgramTitle&&"TvChannel"===itemType&&(item.CurrentProgram?lines.push(item.CurrentProgram.EpisodeTitle||""):lines.push("")),options.showCurrentProgramTime&&"TvChannel"===itemType&&(item.CurrentProgram?lines.push(getAirTimeText(item.CurrentProgram,!1,!0)||""):lines.push("")),options.showSeriesTimerTime&&(item.RecordAnyTime?lines.push(globalize.translate("Anytime")):lines.push(datetime.getDisplayTime(item.StartDate))),options.showSeriesTimerChannel&&(item.RecordAnyChannel?lines.push(globalize.translate("AllChannels")):lines.push(item.ChannelName||globalize.translate("OneChannel"))),options.showPersonRoleOrType&&(item.Role?lines.push(globalize.translate("ActorAsRole",item.Role)):itemType?lines.push(globalize.translate(""+itemType)):lines.push("")),options.showChapterTime&&lines.push(datetime.getDisplayRunningTime(item.StartPositionTicks)),options.showUserLastSeen&&(item.Policy.IsDisabled?lines.push(globalize.translate("Disabled")):lines.push(item.LastActivityDate?humanedate(item.LastActivityDate):"")),options.showContentType&&(item.Id?lines.push(itemHelper.getContentTypeName(item.CollectionType)):lines.push("")),options.showLibraryFolders&&(item.Locations?1===item.Locations.length?lines.push(item.Locations[0]):lines.push(globalize.translate("NumLocationsValue",item.Locations.length)):lines.push("")),options.showDeviceAppInfo&&lines.push(item.AppName+" "+item.AppVersion),options.showVersion&&lines.push(item.Version||""),options.showDownloadableImageInfo&&(lines.push(function(item){var text="",lang=item.DisplayLanguage||item.Language;return item.Width&&item.Height?(text+=item.Width+"x"+item.Height,lang&&(text+=" - "+lang)):lang&&(text+=lang),text}(item)||""),lines.push(function(item){var text;return"Likes"===item.RatingType?text=1===item.CommunityRating?globalize.translate("OneLike"):globalize.translate("LikeCountValue",item.CommunityRating):item.CommunityRating?(text=item.CommunityRating.toFixed(1),item.VoteCount&&(text+=" - "+(1===item.VoteCount?globalize.translate("OneVote"):globalize.translate("VoteCountValue",item.VoteCount)))):text=globalize.translate("Unrated"),text}(item)||"")),options.showDateModified&&lines.push(datetime.toLocaleString(datetime.parseISO8601Date(item.DateModified,!0))),options.showDeviceUserInfo){var deviceHtml="";item.LastUserName&&(item.LastUserId?deviceHtml+=getTextActionButton(options,{Id:item.LastUserId,Name:item.LastUserName,ServerId:serverId,Type:"User"},item.LastUserName+", "+humanedate(item.DateLastActivity),null,null):item.LastUserName&&(deviceHtml+=item.LastUserName+", "+humanedate(item.DateLastActivity))),lines.push(deviceHtml)}}return(showTitle||!imgUrl)&&forceName&&overlayText&&1===lines.length&&(lines=[]),html+=getCardTextLines(lines,cssClass,!overlayText,isOuterFooter,isOuterFooter&&options.cardLayout&&!1!==options.cardFooterAside&&!layoutManager.tv,options.lines),progressHtml&&(html+=progressHtml),html&&(isOuterFooter&&!logoUrl&&!options.cardLayout||(html='<div class="'+footerClass+'">'+html,html+="</div>")),html}function getTextActionButton(options,item,text,serverId,parentId,isSameItemAsCard){if(text=text||itemHelper.getDisplayName(item),layoutManager.tv)return dom.htmlEncode(text);if(!1===options.textLinks)return dom.htmlEncode(text);var html='<button title="'+(text=dom.htmlEncode(text))+'" '+(isSameItemAsCard?"":itemShortcuts.getShortcutAttributesHtml(item,{serverId:serverId,parentId:parentId}))+' type="button" class="itemAction textActionButton cardTextActionButton" data-action="link">';return html+=text,html+="</button>"}function getCardHtml(item,index,options){var itemType=item.Type,action=options.action||"link";item.IsFolder&&"play"===action?action="link":"Photo"===item.MediaType?action="playallfromhere":"AddServer"===item.Type&&(action="link");var shape=options.shape,isSingleClickElement=options.isSingleClickElement,serverId=item.ServerId||options.serverId,apiClient=serverId?connectionManager.getApiClient(serverId):null,imgInfo=getImageUrl(item,apiClient,options,shape),imgUrl=imgInfo.imgUrl,forceName=imgInfo.forceName,overlayText=options.overlayText;forceName&&!options.cardLayout&&null==overlayText&&(overlayText=!0);var showTitle="auto"===options.showTitle||(options.showTitle||overlayText&&("PhotoAlbum"===itemType||"Folder"===itemType)),cardContentClass=options.cardContentClass;(options.coverImage||imgInfo.coverImage)&&(cardContentClass+=" coveredImage","Photo"!==item.MediaType&&"PhotoAlbum"!==itemType&&"Folder"!==itemType&&"Program"!==itemType&&"Recording"!==itemType&&"TvChannel"!==itemType||(cardContentClass+=" coveredImage-noScale")),item.Policy&&item.Policy.IsDisabled&&(cardContentClass+=" grayscaleImage"),options.defaultBackground||imgUrl||(!1===options.randomDefaultBackground?cardContentClass+=" defaultCardBackground defaultCardBackground0":cardContentClass+=" "+function(str){return"defaultCardBackground defaultCardBackground"+getDefaultColorIndex(str)}(item.Name));var footerCssClass,cardBoxClass=options.cardBoxClass,playlistItemId=options.playlistItemId;playlistItemId&&playlistItemId===item.PlaylistItemId&&(cardBoxClass+=" activePlaylistCardBox");var logoUrl,progressHtml=indicators.getProgressBarHtml(item),innerCardFooter="",footerOverlayed=!1;options.showChannelLogo&&item.ChannelPrimaryImageTag?logoUrl=apiClient.getScaledImageUrl(item.ChannelId,{type:"Primary",height:40,tag:item.ChannelPrimaryImageTag}):options.showLogo&&item.ParentLogoImageTag&&(logoUrl=apiClient.getScaledImageUrl(item.ParentLogoItemId,{type:"Logo",height:40,tag:item.ParentLogoImageTag})),overlayText?(innerCardFooter+=getCardFooterText(item,options,showTitle,forceName,overlayText,imgUrl,footerCssClass=progressHtml?"innerCardFooter fullInnerCardFooter":"innerCardFooter",progressHtml,logoUrl=null,!1),footerOverlayed=!0):progressHtml&&(innerCardFooter+='<div class="innerCardFooter fullInnerCardFooter innerCardFooterClear">',innerCardFooter+=progressHtml,innerCardFooter+="</div>",progressHtml="");var cardImageContainerOpen,outerCardFooter="";overlayText||footerOverlayed||(footerCssClass=options.cardLayout?"cardFooter":"cardFooter cardFooter-transparent",logoUrl&&(footerCssClass+=" cardFooter-withlogo"),options.cardLayout||(logoUrl=null),outerCardFooter=getCardFooterText(item,options,showTitle,forceName,overlayText,imgUrl,footerCssClass,progressHtml,logoUrl,!0));var cardImageContainerClose="";if(isSingleClickElement?(cardImageContainerOpen=imgUrl?supportsNativeLazyLoading||2===options.lazy?'<div class="'+cardContentClass+'" loading="lazy" style="background-image:url('+imgUrl+');">':'<div class="'+cardContentClass+' lazy" style="background-image:url('+imgUrl+');">':'<div class="'+cardContentClass+'">',cardImageContainerClose="</div>"):imgUrl&&options.useImgElement?cardImageContainerOpen=(supportsNativeLazyLoading||options.lazy,'<img class="itemAction '+cardContentClass+'" loading="lazy" src="'+imgUrl+'" data-action="'+action+'" />'):cardImageContainerClose="none"===action?(cardImageContainerOpen=imgUrl?supportsNativeLazyLoading||2===options.lazy?'<div data-action="'+action+'" class="itemAction cardContent-button '+cardContentClass+'" loading="lazy" style="background-image:url('+imgUrl+');">':'<div data-action="'+action+'" class="itemAction cardContent-button lazy '+cardContentClass+'" style="background-image:url('+imgUrl+');">':'<div data-action="'+action+'" class="cardContent-button '+cardContentClass+' itemAction">',"</div>"):(cardImageContainerOpen=imgUrl?supportsNativeLazyLoading||2===options.lazy?'<button type="button" data-action="'+action+'" class="itemAction cardContent-button '+cardContentClass+'" loading="lazy" style="background-image:url('+imgUrl+');">':'<button type="button" data-action="'+action+'" class="itemAction cardContent-button lazy '+cardContentClass+'" style="background-image:url('+imgUrl+');">':'<button type="button" data-action="'+action+'" class="cardContent-button '+cardContentClass+' itemAction">',"</button>"),cardImageContainerOpen=options.separateCardPadder?'<div class="'+cardBoxClass+'"><div class="'+options.cardScalableClass+'"><div class="'+options.cardPadderClass+'"></div>'+cardImageContainerOpen:'<div class="'+cardBoxClass+'"><div class="'+options.cardScalableClass+" "+options.cardPadderClass+'">'+cardImageContainerOpen,!1!==options.typeIndicator&&("Video"===itemType?cardImageContainerOpen+='<div class="indicator videoIndicator"><i class="md-icon indicatorIcon">&#xE04B;</i></div>':"Folder"===itemType||"PhotoAlbum"===itemType?cardImageContainerOpen+='<div class="indicator videoIndicator"><i class="md-icon indicatorIcon">&#xE2C7;</i></div>':"Photo"===itemType&&(cardImageContainerOpen+='<div class="indicator videoIndicator"><i class="md-icon indicatorIcon">&#xE410;</i></div>')),!1!==options.missingIndicator&&(cardImageContainerOpen+=indicators.getMissingIndicator(item,"cardIndicator cardMissingIndicator")),!1!==options.syncIndicator){var syncPercent=item.SyncPercent;100===syncPercent?cardImageContainerOpen+='<i class="cardIndicator md-icon cardSyncIndicator syncIndicator fullSyncIndicator">&#xE2C0;</i>':null!=syncPercent&&(cardImageContainerOpen+='<i class="cardIndicator md-icon cardSyncIndicator syncIndicator emptySyncIndicator">&#xE2C0;</i>')}(!1!==options.playedIndicator&&(cardImageContainerOpen+=indicators.getPlayedIndicatorHtml(item,"cardIndicator card")),!1!==options.timerIndicator&&(cardImageContainerOpen+=indicators.getTimerIndicator(item,"cardIndicator card")),"CollectionFolder"===itemType||item.CollectionType)?(cardImageContainerOpen+='<div is="emby-itemrefreshindicator"'+(item.RefreshProgress?"":' class="hide"')+' data-progress="'+(item.RefreshProgress||0)+'" data-status="'+item.RefreshStatus+'"></div>',refreshIndicatorLoaded||(refreshIndicatorLoaded=!0,require(["emby-itemrefreshindicator"]))):"User"===itemType&&item.ConnectLinkType&&(cardImageContainerOpen+='<i class="md-icon cardPlayedIndicator cardIndicator playedIndicator" title="'+globalize.translate("LinkedToEmbyConnect")+'">cloud</i>');imgUrl||(cardImageContainerOpen+=function(item,options){var icon=getDefaultIcon(item,options);if(icon)return'<i class="cardImageIcon md-icon">'+icon+"</i>";return'<div class="cardText cardDefaultText">'+(isUsingLiveTvNaming(item.Type)?item.Name:itemHelper.getDisplayName(item,{includeParentInfo:options.includeParentInfoInTitle,channelNumberFirst:options.channelNumberFirst}))+"</div>"}(item,options));var additionalCardContent="";if(layoutManager.tv||!1===options.hoverMenu||(additionalCardContent+=function(item,action,options){var html="",hasContent=!1;html+='<div class="cardOverlayContainer itemAction" data-action="'+action+'">';var btnCssClass="cardOverlayButton cardOverlayButton-hover itemAction",serverId=item.ServerId||options.serverId,itemType=item.Type,itemId=item.Id;!1!==options.multiSelect&&(hasContent=!0,html+='<label title="'+options.multiSelectTitle+'" data-action="multiselect" data-id="'+itemId+'" data-serverid="'+serverId+'"  class="chkCardSelectContainer cardOverlayButton cardOverlayButton-hover itemAction emby-checkbox-label"><input tabindex="-1" class="chkCardSelect emby-checkbox" is="emby-checkbox" type="checkbox" data-classes="true" /><span class="checkboxLabel"></span></label>');if(!1!==options.hoverPlayButton&&playbackManager.canPlay(item)){hasContent=!0;var playButtonAction=item.IsFolder?"resume":options.playAction||"play";html+='<button tabindex="-1" type="button" is="paper-icon-button-light" class="'+btnCssClass+' cardOverlayFab-primary" data-action="'+playButtonAction+'"><i class="md-icon cardOverlayButtonIcon">&#xE037;</i></button>'}options.hoverDownloadButton&&(hasContent=!0,html+='<button tabindex="-1" type="button" is="paper-icon-button-light" class="'+btnCssClass+' cardOverlayFab-primary" data-action="custom"><i class="md-icon cardOverlayButtonIcon">cloud_download</i></button>');html+='<div class="cardOverlayButton-br">';var userData=item.UserData||{};!1!==options.playedButton&&itemHelper.canMarkPlayed(item)&&"CollectionFolder"!==itemType&&(hasContent=!0,html+='<button tabindex="-1" is="emby-playstatebutton" type="button" data-action="none" class="'+btnCssClass+'" data-id="'+itemId+'" data-serverid="'+serverId+'" data-itemtype="'+itemType+'" data-played="'+userData.Played+'"><i class="md-icon cardOverlayButtonIcon cardOverlayButtonIcon-hover">&#xE5CA;</i></button>');if(!1!==options.ratingButton&&itemHelper.canRate(item)){var likes=null==userData.Likes?"":userData.Likes;hasContent=!0,html+='<button tabindex="-1" is="emby-ratingbutton" type="button" data-action="none" class="'+btnCssClass+'" data-id="'+itemId+'" data-serverid="'+serverId+'" data-itemtype="'+itemType+'" data-likes="'+likes+'" data-isfavorite="'+userData.IsFavorite+'"><i class="md-icon cardOverlayButtonIcon cardOverlayButtonIcon-hover">&#xE87D;</i></button>'}!1!==options.moreButton&&"Program"!==itemType&&"AddServer"!==itemType&&"EmbyConnect"!==itemType&&(hasContent=!0,html+='<button tabindex="-1" type="button" title="'+options.moreTitle+'" is="paper-icon-button-light" class="'+btnCssClass+'" data-action="menu"><i class="md-icon cardOverlayButtonIcon cardOverlayButtonIcon-hover">&#xE5D3;</i></button>');options.previewImageButton&&supportsTargetBlank&&(hasContent=!0,html+='<a href="'+item.OriginalImageUrl+'" target="_blank" tabindex="-1" type="button" title="'+globalize.translate("HeaderOpenInNewWindow")+'" is="emby-linkbutton" class="paper-icon-button-light '+btnCssClass+'" data-action="openlink"><i class="md-icon cardOverlayButtonIcon cardOverlayButtonIcon-hover">open_in_new</i></a>');return hasContent?(html+="</div>",html+="</div>"):""}(item,action,options)),options.cardParts){var attributes=itemShortcuts.getShortcutAttributes(item,options);return options.isSingleClickElement&&attributes.push({name:"data-action",value:action}),attributes.push({name:"data-index",value:index}),options.addTabIndex&&attributes.push({name:"tabindex",value:"0"}),{attributes:attributes,html:cardImageContainerOpen+innerCardFooter+cardImageContainerClose+additionalCardContent+"</div>"+outerCardFooter+"</div>"}}var dataAttributes=itemShortcuts.getShortcutAttributesHtml(item,options);options.isSingleClickElement&&(dataAttributes+=' data-action="'+action+'"'),dataAttributes+=' data-index="'+index+'"',options.addTabIndex&&(dataAttributes+=' tabindex="0"');var tagName=options.tagName;return"<"+tagName+dataAttributes+' class="'+options.className+'">'+cardImageContainerOpen+innerCardFooter+cardImageContainerClose+additionalCardContent+"</div>"+outerCardFooter+"</div></"+tagName+">"}var supportsTargetBlank=appHost.supports("targetblank");var defaultIconsByItemType={MusicAlbum:"&#xE019;",MusicArtist:"&#xE7FD;",Person:"&#xE7FD;",Channel:"&#xE2C7;",Device:"devices",User:"&#xe7fd;",Server:"&#xE63E;",SelectServer:"&#xE63E;",ManualLogin:"&#xe898;",Downloads:"folder",CollectionFolder:"folder",UserView:"folder",ForgotPassword:"&#xe887;",AddServer:"&#xe147;",AddVirtualFolder:"&#xe147;",ActivityLogEntry:"&#xE878;",Log:"description",ApiKey:"vpn_key"},defaultIconsByCollectionType={movies:"&#xE54D;",music:"&#xE310;",homevideos:"&#xE412;",photos:"&#xE412;",livetv:"&#xe1b2;",tvshows:"&#xE333;",games:"&#xe30f;",trailers:"&#xE54D;",musicvideos:"&#xE04A;",books:"&#xE2C7;",channels:"&#xE2C7;",playlists:"&#xe8ef;"},defaultIconsByMediaType={Video:"&#xE54D;",Audio:"&#xE019;",Photo:"&#xE412;",Book:"&#xE2C7;",Game:"&#xe30f;"};function getDefaultIcon(item,options){var icon,collectionType=item.CollectionType;if(collectionType&&(icon=defaultIconsByCollectionType[collectionType]))return icon;var itemType=item.Type;if(itemType&&(icon=defaultIconsByItemType[itemType]))return icon;if(options){var defaultIcon=options.defaultIcon;if(!1===defaultIcon)return null;if("string"==typeof defaultIcon)return defaultIcon}var mediaType=item.MediaType;return mediaType&&(icon=defaultIconsByMediaType[mediaType])?icon:"&#xE2C7;"}function ensureIndicators(card,indicatorsElem){return indicatorsElem||card.querySelector(".cardImageContainer")}function updateUserData(card,userData){var type=card.getAttribute("data-type");if("MusicArtist"!==type&&"MusicAlbum"!==type&&"Audio"!==type&&!card.classList.contains("card-nouserdata")){var enableCountIndicator="Series"===type||"BoxSet"===type||"Season"===type,indicatorsElem=null,playedIndicator=null,countIndicator=null;userData.Played?((playedIndicator=card.querySelector(".playedIndicator"))||((playedIndicator=document.createElement("i")).classList.add("cardIndicator"),playedIndicator.classList.add("cardPlayedIndicator"),playedIndicator.classList.add("playedIndicator"),playedIndicator.classList.add("md-icon"),(indicatorsElem=ensureIndicators(card,indicatorsElem)).appendChild(playedIndicator)),playedIndicator.innerHTML="&#xE5CA;"):(playedIndicator=card.querySelector(".playedIndicator"))&&playedIndicator.parentNode.removeChild(playedIndicator),userData.UnplayedItemCount?((countIndicator=card.querySelector(".countIndicator"))||((countIndicator=document.createElement("div")).classList.add("countIndicator"),countIndicator.classList.add("cardCountIndicator"),countIndicator.classList.add("cardIndicator"),(indicatorsElem=ensureIndicators(card,indicatorsElem)).appendChild(countIndicator)),countIndicator.innerHTML=userData.UnplayedItemCount):enableCountIndicator&&(countIndicator=card.querySelector(".countIndicator"))&&countIndicator.parentNode.removeChild(countIndicator);var progressHtml=indicators.getProgressBarHtml({Type:type,UserData:userData,MediaType:"Video"}),itemProgressBar=card.querySelector(".itemProgressBar"),progressBarParent=itemProgressBar?itemProgressBar.parentNode:null;if(itemProgressBar&&progressBarParent.removeChild(itemProgressBar),progressHtml){if(!(progressBarParent=progressBarParent||card.querySelector(".innerCardFooter"))){var innerCardFooter=document.createElement("div");innerCardFooter.classList.add("innerCardFooter"),(card.querySelector(".cardImageContainer")||card.querySelector(".cardScalable")).appendChild(innerCardFooter),progressBarParent=innerCardFooter}progressBarParent.insertAdjacentHTML("beforeEnd",progressHtml)}}}return{setCardData:setCardData,setListOptions:setCardData,getCardsHtml:getCardsHtml,getItemsHtml:getCardsHtml,getCardHtml:getCardHtml,getItemParts:function(item,index,options){return options.cardParts=!0,getCardHtml(item,index,options)},buildCards:function(items,options){var itemsContainer=options.itemsContainer;if(document.body.contains(itemsContainer)){var parentContainer=options.parentContainer;if(parentContainer){if(!items.length)return void parentContainer.classList.add("hide");parentContainer.classList.remove("hide")}var html=buildCardsHtmlInternal(items,options);itemsContainer.innerHTML=html,itemsContainer.items=items,html&&imageLoader.lazyChildren(itemsContainer),options.autoFocus&&focusManager.autoFocus(itemsContainer)}},onUserDataChanged:function(userData,scope){for(var cards=(scope||document.body).querySelectorAll('.card[data-id="'+userData.ItemId+'"]'),i=0,length=cards.length;i<length;i++)updateUserData(cards[i],userData)},onTimerCreated:function(programId,newTimerId,itemsContainer){for(var cells=itemsContainer.querySelectorAll('.card[data-id="'+programId+'"]'),i=0,length=cells.length;i<length;i++){var cell=cells[i];if(!cell.querySelector(".timerIndicator"))ensureIndicators(cell).insertAdjacentHTML("beforeend",'<i class="md-icon timerIndicator indicatorIcon">&#xE061;</i>');cell.setAttribute("data-timerid",newTimerId)}},onTimerCancelled:function(id,itemsContainer){for(var cells=itemsContainer.querySelectorAll('.card[data-timerid="'+id+'"]'),i=0,length=cells.length;i<length;i++){var cell=cells[i],icon=cell.querySelector(".timerIndicator");icon&&icon.parentNode.removeChild(icon),cell.removeAttribute("data-timerid")}},onSeriesTimerCancelled:function(id,itemsContainer){for(var cells=itemsContainer.querySelectorAll('.card[data-seriestimerid="'+id+'"]'),i=0,length=cells.length;i<length;i++){var cell=cells[i],icon=cell.querySelector(".timerIndicator");icon&&icon.parentNode.removeChild(icon),cell.removeAttribute("data-seriestimerid")}},getDefaultIcon:getDefaultIcon,getImageUrl:getImageUrl}});