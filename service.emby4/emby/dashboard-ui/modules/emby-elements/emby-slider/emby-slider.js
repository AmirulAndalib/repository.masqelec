define(["browser","dom","css!./emby-slider","emby-input"],function(browser,dom){"use strict";var supportsNativeProgressStyle=browser.firefox;if(!supportsNativeProgressStyle&&Object.getOwnPropertyDescriptor&&Object.defineProperty){var descriptor=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value");if(descriptor&&descriptor.configurable){var baseSetMethod=descriptor.set;descriptor.set=function(value){baseSetMethod.call(this,value),this.dispatchEvent(new CustomEvent("valueset",{bubbles:!1,cancelable:!1}))},Object.defineProperty(HTMLInputElement.prototype,"value",descriptor)}}function updateValues(){var range=this,value=range.value;requestAnimationFrame(function(){var backgroundLower=range.backgroundLower;if(backgroundLower){var fraction=(value-range.min)/(range.max-range.min);fraction*=100,backgroundLower.style.width=fraction+"%"}})}function updateBubble(range,value,bubble){var html=value;html=range.getBubbleHtml?(value=Math.min(Math.max(5,value),95),range.getBubbleHtml(html)):'<h1 class="sliderBubbleText">'+(html=range.getBubbleText?range.getBubbleText(html):Math.round(html))+"</h1>",bubble.style.left=value+"%",bubble.innerHTML=html}var isFlexSupported=function(prop,value){if("undefined"==typeof window)return!1;if(value=2===arguments.length?value:"inherit","CSS"in window&&"supports"in window.CSS)return window.CSS.supports(prop,value);if("supportsCSS"in window)return window.supportsCSS(prop,value);try{var camel=prop.replace(/-([a-z]|[0-9])/gi,function(all,letter){return(letter+"").toUpperCase()}),el=document.createElement("div");if(camel in el.style)return el.style.cssText=prop+":"+value,""!==el.style[camel]}catch(err){}return!1}("display","flex");function _connectedCallback(){if("true"!==this.getAttribute("data-embyslider")){this.setAttribute("data-embyslider","true"),this.classList.add("emby-slider"),isFlexSupported||this.classList.add("slider-no-webkit-thumb");var containerElement=this.parentNode;containerElement.classList.add("emby-slider-container");var htmlToInsert="";supportsNativeProgressStyle||(htmlToInsert+='<div class="emby-slider-background">',htmlToInsert+='<div class="emby-slider-background-inner">',htmlToInsert+='<div class="emby-slider-background-upper"></div>',htmlToInsert+='<div class="emby-slider-background-lower"></div>',htmlToInsert+="</div>",htmlToInsert+="</div>"),htmlToInsert+='<div class="sliderBubble hide"></div>',containerElement.insertAdjacentHTML("beforeend",htmlToInsert),this.backgroundLower=containerElement.querySelector(".emby-slider-background-lower"),this.backgroundUpper=containerElement.querySelector(".emby-slider-background-upper");var sliderBubble=containerElement.querySelector(".sliderBubble"),hasHideClass=sliderBubble.classList.contains("hide");dom.addEventListener(this,"input",function(e){this.dragging=!0,updateBubble(this,this.value,sliderBubble),hasHideClass&&(sliderBubble.classList.remove("hide"),hasHideClass=!1)},{passive:!0}),dom.addEventListener(this,"change",function(){this.dragging=!1,updateValues.call(this),sliderBubble.classList.add("hide"),hasHideClass=!0},{passive:!0}),browser.firefox||(dom.addEventListener(this,window.PointerEvent?"pointermove":"mousemove",function(e){if(!this.dragging){var rect=this.getBoundingClientRect(),bubbleValue=(e.clientX-rect.left)/rect.width;updateBubble(this,bubbleValue*=100,sliderBubble),hasHideClass&&(sliderBubble.classList.remove("hide"),hasHideClass=!1)}},{passive:!0}),dom.addEventListener(this,window.PointerEvent?"pointerleave":"mouseleave",function(){sliderBubble.classList.add("hide"),hasHideClass=!0},{passive:!0})),supportsNativeProgressStyle||function(range){var interval=range.interval;interval&&clearInterval(interval);range.interval=setInterval(updateValues.bind(range),100)}(this)}}function setRange(elem,startPercent,endPercent){var style=elem.style;style.left=Math.max(startPercent,0)+"%";var widthPercent=endPercent-startPercent;style.width=Math.max(Math.min(widthPercent,100),0)+"%"}function _setBufferedRanges(ranges,runtime,position){var elem=this.backgroundUpper;if(elem){null!=runtime&&(ranges=function(ranges,runtime){return runtime?ranges.map(function(r){return{start:r.start/runtime*100,end:r.end/runtime*100}}):[]}(ranges,runtime),position=position/runtime*100);for(var i=0,length=ranges.length;i<length;i++){var range=ranges[i];if(!(null!=position&&position>=range.end))return void setRange(elem,range.start,range.end)}setRange(elem,0,0)}}function _setIsClear(isClear){var backgroundLower=this.backgroundLower;backgroundLower&&(isClear?backgroundLower.classList.add("emby-slider-background-lower-clear"):backgroundLower.classList.remove("emby-slider-background-lower-clear"))}function _disconnectedCallback(){var interval=this.interval;interval&&clearInterval(interval),this.interval=null,this.backgroundUpper=null,this.backgroundLower=null}if(window.customElements){var EmbySlider=function(_HTMLInputElement){babelHelpers.inherits(EmbySlider,_HTMLInputElement);var _super=_createSuper(EmbySlider);function EmbySlider(){var _this;babelHelpers.classCallCheck(this,EmbySlider);var self=_this=_super.call(this);return babelHelpers.possibleConstructorReturn(_this,self)}return babelHelpers.createClass(EmbySlider,[{key:"connectedCallback",value:function(){_connectedCallback.call(this)}},{key:"disconnectedCallback",value:function(){_disconnectedCallback.call(this)}},{key:"setBufferedRanges",value:function(){_setBufferedRanges.apply(this,arguments)}},{key:"setIsClear",value:function(){_setIsClear.apply(this,arguments)}}]),EmbySlider}(babelHelpers.wrapNativeSuper(HTMLInputElement));customElements.define("emby-slider",EmbySlider,{extends:"input"})}else if(document.registerElement){var EmbySliderPrototype=Object.create(HTMLInputElement.prototype);EmbySliderPrototype.attachedCallback=_connectedCallback,EmbySliderPrototype.detachedCallback=_disconnectedCallback,EmbySliderPrototype.setBufferedRanges=_setBufferedRanges,EmbySliderPrototype.setIsClear=_setIsClear,document.registerElement("emby-slider",{prototype:EmbySliderPrototype,extends:"input"})}});