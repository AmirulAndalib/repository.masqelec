define(["browser","appSettings","events","apphost"],function(browser,appSettings,events,appHost){"use strict";var currentLayout;function setLayout(instance,layout,selectedLayout){layout===selectedLayout?(instance[layout]=!0,"tv"===layout&&document.documentElement.classList.add("layout-"+layout)):(instance[layout]=!1,"tv"===layout&&document.documentElement.classList.remove("layout-"+layout))}function LayoutManager(){}LayoutManager.prototype.setLayout=function(layout,save){if(layout&&"auto"!==layout){setLayout(this,"mobile",layout),setLayout(this,"tv",layout),setLayout(this,"desktop",layout),!1!==save&&appSettings.set("layout",layout);var changed=currentLayout!==layout;currentLayout=layout,changed&&events.trigger(this,"modechange")}else this.autoLayout(),!1!==save&&appSettings.set("layout","")},LayoutManager.prototype.getSavedLayout=function(layout){return appSettings.get("layout")},LayoutManager.prototype.autoLayout=function(){this.setLayout(this.getDefaultLayout(),!1)};(navigator.userAgent||"").toLowerCase().indexOf("electron");return LayoutManager.prototype.getDefaultLayout=function(){if(this.getPlatformDefaultLayout){var result=this.getPlatformDefaultLayout();if(result)return result}return browser.xboxOne||browser.ps4||browser.chromecast||browser.netcast||browser.operaTv?"tv":function(){var terms=["mobi","ipad","iphone","ipod","silk","gt-p1000","nexus 7","kindle fire","opera mini"],lower=navigator.userAgent.toLowerCase();if(-1!==lower.indexOf("android tv"))return!1;for(var i=0,length=terms.length;i<length;i++)if(-1!==lower.indexOf(terms[i]))return!0;return!1}()?"mobile":browser.tv?"tv":function(){try{if(window.matchMedia("(pointer: coarse)").matches)return!0;if(window.matchMedia("(pointer: fine)").matches)return!1;if(window.matchMedia("(pointer: none)").matches)return!1}catch(err){console.log("error using window.matchMedia")}return"ontouchstart"in document.documentElement}()?"mobile":-1!==(navigator.userAgent||"").toLowerCase().indexOf("electron")?"tv":-1!==window.location.href.toString().toLowerCase().indexOf("tv.emby")?"tv":"desktop"},LayoutManager.prototype.init=function(){var saved=this.getSavedLayout();saved?this.setLayout(saved,!1):this.autoLayout()},new LayoutManager});