define(["appSettings","dom","globalize","appRouter","emby-checkbox","emby-select","emby-input","emby-button","paper-icon-button-light","emby-scroller"],function(appSettings,dom,globalize,appRouter){"use strict";function onAndroidSyncLocationChange(){MainActivity.authorizeStorage()}function loadForm(view){view.querySelector("#txtSyncPath").value=appSettings.syncPath()||"",view.querySelector("#chkWifi").checked=appSettings.syncOnlyOnWifi(),view.querySelector(".selectAudioBitrate").value=appSettings.maxStaticMusicBitrate()||"",window.AndroidAppSettings&&function(view){for(var html='<option value="">'+globalize.translate("InternalStorage")+"</option>",dirs=AndroidAppHost.getWritableExternalStorageDirs(),size=dirs.size(),i=0;i<size;i++){var dir=dirs.get(i),name=dir.getName(),uuid=dir.getUuid(),value="%externalstorage%";uuid&&(value=uuid),html+='<option value="'+value+'">'+globalize.translate("ExternalStorage")+" ("+name+")</option>"}var selectSyncLocation=view.querySelector("#selectSyncLocation");selectSyncLocation.innerHTML=html,selectSyncLocation.value=appSettings.syncPath()||""}(view)}function saveUser(){window.AndroidAppSettings?(appSettings.syncPath(this.querySelector("#selectSyncLocation").value),AndroidAppSettings.setSyncPath(this.querySelector("#selectSyncLocation").value),AndroidAppSettings.setSyncOnlyOnWifi(this.querySelector("#chkWifi").checked)):appSettings.syncPath(this.querySelector("#txtSyncPath").value),appSettings.syncOnlyOnWifi(this.querySelector("#chkWifi").checked),appSettings.maxStaticMusicBitrate(this.querySelector(".selectAudioBitrate").value||null),require(["localsync"],function(localSync){localSync.sync()})}function selectDownloadPathWindows(){var inputContainer=dom.parentWithClass(this,"inputContainer"),folderPicker=new Windows.Storage.Pickers.FolderPicker;folderPicker.suggestedStartLocation=Windows.Storage.Pickers.PickerLocationId.desktop,folderPicker.fileTypeFilter.replaceAll(["*"]),folderPicker.pickSingleFolderAsync().then(function(folder){folder?(Windows.Storage.AccessCache.StorageApplicationPermissions.futureAccessList.addOrReplace("PickedFolderToken",folder),inputContainer.querySelector(".txtSyncPath").value=folder.path,appSettings.syncPath(folder.path),console.log("Picked folder: "+folder.path)):console.log("Operation cancelled.")})}return function(view,params){window.AndroidAppSettings?(view.querySelector(".fldSyncLocation").classList.remove("hide"),view.querySelector("#selectSyncLocation").addEventListener("change",onAndroidSyncLocationChange)):view.querySelector(".fldSyncLocation").classList.add("hide"),window.Windows?(view.querySelector(".fldCustomSyncPath").classList.remove("hide"),view.querySelector("#btnSelectSyncPath").addEventListener("click",selectDownloadPathWindows)):view.querySelector(".fldCustomSyncPath").classList.add("hide"),view.querySelector("form").addEventListener("submit",function(e){return saveUser.call(view),e.preventDefault(),!1}),view.addEventListener("viewshow",function(){loadForm(this),appRouter.setTitle(globalize.translate("Downloads"))}),view.addEventListener("viewbeforehide",saveUser)}});